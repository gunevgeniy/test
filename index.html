<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
    <!-- –ó–ê–ü–†–ï–¢ –ò–ù–î–ï–ö–°–ê–¶–ò–ò -->
  <meta name="robots" content="noindex, nofollow, noarchive">
  <meta name="yandex" content="noindex, nofollow">
  <!-- /–ó–ê–ü–†–ï–¢ –ò–ù–î–ï–ö–°–ê–¶–ò–ò -->
  <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–∞ UIS</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Manrope:wght@500;700;800&display=swap" rel="stylesheet">
  
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  
  <style>
    :root {
      --color-primary: #0000aa;
      --color-primary-light: rgba(0, 0, 170, 0.08);
      --color-bg: #F0F2F5;
      --color-card-bg: #FFFFFF;
      --color-input-bg: #FFFFFF;
      --color-input-border: #C4C4C4;
      --color-text-main: #252525;
      --color-text-secondary: #878787;
      --color-limit: #e67e22; 
      --radius-card: 20px;
      --radius-input: 10px;
      --shadow-card: 0 4px 20px rgba(0, 0, 0, 0.05);
      --font-head: 'Manrope', sans-serif;
      --font-body: 'Inter', sans-serif;
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body { font-family: var(--font-body); background-color: var(--color-bg); color: var(--color-text-main); margin: 0; padding: 0; overflow-x: hidden; }

    .bg-cloud {
      position: fixed; top: -10%; left: -10%; width: 70vw; height: 70vw;
      background: radial-gradient(circle, rgba(0,0,170,0.12) 0%, rgba(255,255,255,0) 70%);
      filter: blur(80px); z-index: -1; pointer-events: none;
    }

    .layout-wrapper {
      max-width: 1200px; margin: 0 auto; padding: 40px 20px 140px 20px;
      display: grid; grid-template-columns: 1fr 340px; gap: 30px; align-items: start;
    }
    .main-column { display: flex; flex-direction: column; gap: 24px; }
    .sidebar-column { position: sticky; top: 24px; z-index: 10; }

    .card {
      background: var(--color-card-bg); border-radius: var(--radius-card);
      padding: 24px; box-shadow: var(--shadow-card);
    }
    .card-group { position: relative; } 

    .card-header {
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 15px; cursor: pointer;
    }
    .card-header.static { cursor: default; margin-bottom: 20px;} 

    .card-title { font-size: 18px; font-weight: 700; font-family: var(--font-head); color: var(--color-primary); display: flex; align-items: center; gap: 10px;}

    .header-toggle-icon {
        width: 0; height: 0; border-left: 6px solid transparent; border-right: 6px solid transparent;
        border-top: 8px solid var(--color-primary); transition: transform 0.3s;
    }
    .card-header.collapsed .header-toggle-icon { transform: rotate(-90deg); }

    .option-row {
      display: grid; 
      grid-template-columns: 1fr 150px; 
      gap: 15px; 
      padding: 16px 0; 
      border-bottom: 1px solid #eef2f6;
      align-items: center;
    }
    .option-row:last-child { border-bottom: none; }
    
    .option-row.stacked {
        grid-template-columns: 1fr;
        gap: 6px; 
        align-items: start;
    }
    .option-row.stacked .control-wrapper {
        width: 100%;
        justify-content: flex-start;
    }

    .option-info { display: flex; flex-direction: column; gap: 6px; }
    
    .option-name { font-weight: 600; font-size: 15px; line-height: 1.4; display: block; }
    .option-meta { font-size: 12px; display: flex; flex-direction: column; gap: 4px; align-items: flex-start; min-height: 24px; justify-content: center; }

    .price-badge {
      display: inline-flex; align-items: center; padding: 2px 8px; border-radius: 6px; 
      font-weight: 600; font-size: 11px; white-space: nowrap; line-height: 1.4;
    }
    .price-badge.cost { background: #E6F0FF; color: var(--color-primary); }
    .price-badge.limit { background: #FFF4E6; color: var(--color-limit); }

    .info-icon {
      display: inline-flex; align-items: center; justify-content: center;
      width: 18px; height: 18px;
      background: var(--color-primary-light); color: var(--color-primary);
      border-radius: 50%; font-size: 11px; font-weight: 800; font-family: serif; cursor: pointer;
      vertical-align: middle; margin-left: 4px; margin-bottom: 2px;
    }

    .control-wrapper { display: flex; justify-content: flex-end; align-items: center; }

    .toggle-switch { position: relative; display: inline-block; width: 46px; height: 26px; }
    .toggle-switch input { opacity: 0; width: 0; height: 0; }
    .slider {
      position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0;
      background-color: #D1D1D1; transition: .3s; border-radius: 34px;
    }
    .slider:before {
      position: absolute; content: ""; height: 20px; width: 20px; left: 3px; bottom: 3px;
      background-color: white; transition: .3s; border-radius: 50%; box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    input:checked + .slider { background-color: var(--color-primary); }
    input:checked + .slider:before { transform: translateX(20px); }

    .stepper {
      display: flex; align-items: center; 
      background: var(--color-input-bg);
      border: 1px solid var(--color-input-border);
      border-radius: var(--radius-input); 
      padding: 3px; 
      box-shadow: 0 2px 5px rgba(0,0,0,0.03);
    }
    .stepper-btn {
      width: 30px; height: 30px; border: none; background: #F0F4FF;
      border-radius: 8px; color: var(--color-primary); font-weight: 700;
      font-size: 18px; cursor: pointer; display: flex; align-items: center; justify-content: center;
      transition: all 0.2s;
    }
    .stepper-btn:active { background: #dce6ff; }
    .stepper-input {
      width: 50px; border: none; background: transparent; text-align: center;
      font-family: var(--font-body); font-weight: 600; font-size: 15px;
      color: var(--color-text-main); padding: 0; -moz-appearance: textfield; outline: none;
    }
    .stepper-input::selection { background: var(--color-primary-light); }

    .custom-select-trigger {
        width: 100%;
        background: var(--color-input-bg);
        border: 1px solid var(--color-input-border);
        padding: 10px 12px;
        border-radius: var(--radius-input);
        font-size: 14px;
        font-weight: 500;
        color: var(--color-text-main);
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 2px 5px rgba(0,0,0,0.03);
        transition: border 0.2s;
        min-height: 42px;
    }
    .custom-select-trigger:hover { border-color: var(--color-primary); }
    .custom-select-trigger::after { content: "‚ñº"; font-size: 10px; opacity: 0.6; margin-left: 8px; }
    .hidden-native-select { display: none; }

    .readonly-field {
        background: #EAEAEA; padding: 8px 16px; border-radius: var(--radius-input);
        font-weight: 700; color: #555; display: flex; align-items: center; gap: 6px;
        border: 1px solid #ccc;
    }

    .fmc-container {
      border: 1px solid #D0D0D0; border-radius: 16px; padding: 20px;
      margin-top: 10px; background: #FFFFFF; position: relative;
      box-shadow: 0 4px 10px rgba(0,0,0,0.02);
    }
    .fmc-title {
        font-size: 12px; font-weight: 800; text-transform: uppercase;
        color: var(--color-primary); margin-bottom: 12px; letter-spacing: 0.8px;
    }
    
    .fmc-subgroup { display: flex; flex-direction: column; }
    .fmc-subgroup .option-row { border-bottom: none; padding: 8px 0; }
    .fmc-cost-row { padding-top: 10px; border-top: 1px dashed #e0e0e0; margin-top: 5px; display: flex; justify-content: flex-start; }

    .summary-card {
      background: var(--color-primary); color: #fff; padding: 24px;
      border-radius: var(--radius-card); box-shadow: 0 10px 40px rgba(0, 0, 170, 0.25);
    }
    .summary-total { text-align: center; margin-bottom: 24px; }
    .summary-total-label { font-size: 14px; opacity: 0.8; margin-bottom: 8px; }
    .summary-total-value { font-size: 32px; font-family: var(--font-head); font-weight: 800; line-height: 1; }
    .summary-currency { font-size: 20px; font-weight: 500; }
    .summary-details { margin-bottom: 24px; }
    .summary-row {
      display: flex; justify-content: space-between; margin-bottom: 14px;
      font-size: 14px; opacity: 0.95; padding-bottom: 8px;
      border-bottom: 1px solid rgba(255,255,255,0.15);
    }
    .summary-row:last-child { border: none; }
    .summary-row span:last-child { font-weight: 700; white-space: nowrap;}
    
    .button-group { display: flex; gap: 10px; }
    .btn-reset { flex: 1; padding: 14px; background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.3); color: #fff; border-radius: 12px; cursor: pointer; font-weight: 600; font-size: 14px; transition: background 0.3s; }
    .btn-reset:hover { background: rgba(255,255,255,0.25); }
    .btn-print { flex: 1; padding: 14px; background: #fff; border: none; color: var(--color-primary); border-radius: 12px; cursor: pointer; font-weight: 700; font-size: 14px; transition: transform 0.2s; }
    .btn-print:hover { transform: scale(1.02); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }

    .expert-toggle-btn {
        display: inline-flex; align-items: center; justify-content: center; gap: 8px;
        background: #FFFFFF; border: 1px solid #D0D0D0;
        color: var(--color-primary); font-weight: 700;
        cursor: pointer; 
        font-size: 14px; margin-top: 20px; transition: all 0.2s;
        padding: 12px 24px; border-radius: 30px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }
    .expert-toggle-btn:hover { background: #F8F9FC; border-color: var(--color-primary); }
    .expert-toggle-btn .toggle-icon {
        width: 0; height: 0; border-left: 5px solid transparent; border-right: 5px solid transparent;
        border-top: 6px solid var(--color-primary); transition: transform 0.3s;
    }
    .expert-toggle-btn.active .toggle-icon { transform: rotate(180deg); }
    
    .expert-block { display: none; margin-top: 20px; padding-top: 10px; border-top: 1px dashed #e0e0e0; }

    .bottom-sheet { display: none; position: fixed; bottom: 0; left: 0; width: 100%; background: #fff; z-index: 500; box-shadow: 0 -5px 30px rgba(0,0,0,0.15); border-radius: 24px 24px 0 0; flex-direction: column; transition: transform 0.3s ease; }
    .sheet-header { padding: 16px 20px; display: flex; justify-content: space-between; align-items: center; background: var(--color-primary); color: white; border-radius: 24px 24px 0 0; cursor: pointer; }
    .sheet-main-info { display: flex; align-items: center; justify-content: space-between; width: 100%; }
    .sheet-label { font-size: 14px; opacity: 0.9; font-weight: 500; }
    .sheet-price { font-family: var(--font-head); font-weight: 800; font-size: 20px; white-space: nowrap; margin-left: 10px;}
    .sheet-icon { transition: transform 0.3s; font-size: 12px; opacity: 0.7; margin-left: 10px; }
    .sheet-content { padding: 24px; display: none; background: #fff; max-height: 60vh; overflow-y: auto; }
    .sheet-content.open { display: block; }
    .sheet-row { display: flex; justify-content: space-between; margin-bottom: 12px; font-size: 14px; color: #333; align-items: center; }
    .sheet-reset { margin-top: 20px; width: 100%; padding: 14px; background: #F0F0F0; color: #333; border: none; border-radius: 12px; font-weight: 700; }

    .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); backdrop-filter: blur(4px); z-index: 1000; display: none; align-items: center; justify-content: center; padding: 20px; opacity: 0; transition: opacity 0.2s; }
    .modal-overlay.open { display: flex; opacity: 1; }
    .modal-content { background: #fff; padding: 25px; border-radius: 24px; max-width: 400px; width: 100%; box-shadow: 0 20px 60px rgba(0,0,0,0.2); position: relative; max-height: 80vh; overflow-y: auto; }
    .modal-close { position: absolute; top: 15px; right: 20px; font-size: 24px; cursor: pointer; color: #aaa; z-index: 5; }
    .modal-text { font-size: 14px; line-height: 1.6; color: #444; }
    .modal-options-list { display: flex; flex-direction: column; gap: 8px; margin-top: 10px; }
    .modal-option-item { padding: 12px 16px; background: #F5F7FA; border-radius: 12px; cursor: pointer; font-weight: 500; transition: background 0.2s; display: flex; justify-content: space-between; align-items: center; }
    .modal-option-item:hover { background: #E6F0FF; color: var(--color-primary); }
    .modal-option-item.selected { background: var(--color-primary); color: white; }
    .modal-title { font-family: var(--font-head); font-weight: 700; font-size: 18px; margin-bottom: 15px; display: block; }

    .manager-form { display: flex; flex-direction: column; gap: 15px; }
    .form-group label { font-size: 13px; font-weight: 600; color: var(--color-text-secondary); margin-bottom: 5px; display: block; }
    .form-group input { width: 100%; padding: 12px; border: 1px solid #D0D0D0; border-radius: 10px; font-size: 15px; outline: none; transition: border 0.2s; }
    .form-group input:focus { border-color: var(--color-primary); }
    .form-group input.invalid { border-color: #ff4d4f; background: #fff1f0; }
    .btn-manager-print { width: 100%; padding: 14px; background: var(--color-primary); color: white; border: none; border-radius: 12px; font-weight: 700; cursor: pointer; font-size: 16px; margin-top: 10px; }
    .btn-manager-print:hover { background: #000088; }

    /* ========================================= */
    /* NEW BEAUTIFUL TOAST (MODAL STYLE) */
    /* ========================================= */
    #mobile-toast {
        display: none;
        position: fixed;
        top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.6); /* –¢–µ–º–Ω—ã–π —Ñ–æ–Ω */
        backdrop-filter: blur(4px);   /* –†–∞–∑–º—ã—Ç–∏–µ —Ñ–æ–Ω–∞ */
        z-index: 99999;
        align-items: flex-end; /* –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–Ω–∏–∑—É, –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ */
        justify-content: center;
        opacity: 0;
        transition: opacity 0.3s;
    }
    
    #mobile-toast.visible {
        display: flex;
        opacity: 1;
    }

    .toast-card {
        background: #fff;
        color: #1f1f1f;
        width: 90%;
        max-width: 400px;
        border-radius: 24px;
        padding: 24px;
        text-align: center;
        box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        margin-bottom: 40px; /* –û—Ç—Å—Ç—É–ø —Å–Ω–∏–∑—É */
        transform: translateY(20px);
        transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    
    #mobile-toast.visible .toast-card {
        transform: translateY(0);
    }

    .toast-icon {
        font-size: 48px;
        margin-bottom: 16px;
        display: block;
    }
    
    #toast-title {
        font-family: var(--font-head);
        font-size: 20px;
        font-weight: 800;
        margin-bottom: 8px;
        color: #000;
    }
    
    #toast-message {
        font-family: var(--font-body);
        font-size: 15px;
        line-height: 1.5;
        color: #555;
        margin-bottom: 24px;
    }
    
    .toast-btn {
        background: var(--color-primary);
        color: #fff;
        border: none;
        width: 100%;
        padding: 14px;
        border-radius: 14px;
        font-weight: 700;
        font-size: 16px;
        cursor: pointer;
        transition: transform 0.1s;
    }
    .toast-btn:active { transform: scale(0.98); }

    /* Types colors */
    .toast-type-success .toast-icon { color: #2ecc71; }
    .toast-type-error .toast-icon { color: #e74c3c; }
    .toast-type-loading .toast-icon { animation: spin 2s infinite linear; }
    
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    /* PRINT STYLES */
    @page {
        size: A4;
        margin: 0.8cm;
    }

    #print-area { display: none; }

    @media print {
        body { background: white; color: black; font-family: 'Inter', sans-serif; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
        .layout-wrapper, .bg-cloud, .bottom-sheet, .modal-overlay, .expert-toggle-btn, #mobile-toast { display: none !important; }
        #print-area { display: flex !important; flex-direction: column; padding: 0; min-height: 100vh; }
    }

    .pdf-mode {
        overflow: visible !important;
        height: auto !important;
    }
    .pdf-mode body { background: white; color: black; overflow: visible !important; }
    .pdf-mode .layout-wrapper, 
    .pdf-mode .bg-cloud, 
    .pdf-mode .bottom-sheet, 
    .pdf-mode .modal-overlay, 
    .pdf-mode .expert-toggle-btn,
    .pdf-mode #mobile-toast { display: none !important; }
    
    .pdf-mode #print-area { 
        display: block !important; 
        position: relative !important; 
        top: auto;
        left: auto;
        width: 750px !important; 
        max-width: 750px !important;
        margin: 0 !important;
        padding: 20px !important; 
        box-sizing: border-box !important;
        min-height: 100vh;
        z-index: 99999;
        background: white;
    }

    .print-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; border-bottom: 3px solid var(--color-primary); padding-bottom: 20px; }
    .print-logo { font-family: 'Manrope', sans-serif; font-weight: 800; font-size: 32px; color: var(--color-primary); }
    .print-title { font-size: 18px; font-weight: 700; text-transform: uppercase; color: #333; }
    
    .print-manager { margin-bottom: 30px; padding: 15px; background: #F8F9FC; border-radius: 12px; border: 1px solid #eee; }
    .print-manager h3 { margin: 0 0 10px 0; font-size: 14px; color: var(--color-primary); text-transform: uppercase; }
    .print-manager p { margin: 4px 0; font-size: 14px; color: #333; }

    .print-section { 
        margin-bottom: 20px; 
        page-break-inside: auto; 
        break-inside: auto;
        border: 1px solid #e0e0e0;
        border-radius: 16px;
        padding: 15px 20px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.03);
        background: #fff;
    }
    
    .print-section-title { display: none; }

    .print-table { width: 100%; border-collapse: collapse; }
    .print-table td { padding: 10px 5px; border-bottom: 1px solid #f0f0f0; vertical-align: middle; }
    
    .print-table tr { 
        page-break-inside: avoid; 
        break-inside: avoid; 
    }
    .print-table tr:last-child td { border-bottom: none; }
    
    .print-row-name { font-weight: 700; font-size: 14px; color: #000; margin-bottom: 2px; }
    .print-row-desc { font-size: 10px; color: #777; line-height: 1.3; white-space: pre-wrap; margin-top: 4px; }
    .print-row-value { font-weight: 600; font-size: 13px; text-align: right; white-space: nowrap; }
    
    .print-totals { 
        background: #F0F2F5; 
        border-radius: 16px; 
        padding: 25px; 
        margin-top: 30px; 
        margin-bottom: 30px;
        page-break-inside: avoid; 
        break-inside: avoid;
    }
    .print-total-row { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 13px; }
    .print-total-row.main { margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid #ccc; align-items: center; }
    .print-total-row.main .label { font-size: 18px; font-weight: 800; color: var(--color-primary); text-transform: uppercase; }
    .print-total-row.main .value { font-size: 28px; font-weight: 800; color: var(--color-primary); }
    .print-total-helper { display: block; font-size: 9px; color: #777; margin-top: 2px; line-height: 1.4; max-width: 300px; white-space: pre-wrap; }

    .print-social { 
        margin-top: auto; 
        padding-top: 20px; 
        border-top: 2px solid #eee; 
        page-break-inside: avoid; 
        break-inside: avoid;
    }
    .print-social-title { display: none; }
    
    .print-social-list { 
        display: grid; 
        grid-template-columns: 1fr 1fr 1fr; 
        gap: 12px; 
    }
    .print-social-link { 
        font-size: 11px; 
        color: #777; 
        text-decoration: none; 
        display: flex; 
        align-items: center;
        justify-content: center;
        background: #fcfcfc;
        padding: 10px;
        border-radius: 8px;
        border: 1px solid #eee;
        transition: 0.2s;
    }
    .print-social-link span { 
        font-weight: 700; 
        color: #666; 
        margin-right: 0;
    }

    @media (max-width: 900px) {
      .layout-wrapper { grid-template-columns: 1fr; }
      .sidebar-column { display: none; }
      .bottom-sheet { display: flex; }
      .option-row { grid-template-columns: 1fr 140px; gap: 10px; } 
      .option-row.stacked { grid-template-columns: 1fr; }
      .card { padding: 16px; }
    }
    .tooltip-content-hidden { display: none; }
  </style>
  <!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105781169', 'ym');

    ym(105781169, 'init', {ssr:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/105781169" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->
</head>
<body>

<!-- –ù–æ–≤–æ–µ –∫—Ä–∞—Å–∏–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ -->
<div id="mobile-toast" onclick="closeToastBackdrop(event)">
    <div class="toast-card">
        <div class="toast-icon" id="toast-icon">‚è≥</div>
        <div id="toast-title">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        <div id="toast-message">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ.</div>
        <button class="toast-btn" onclick="closeToast()">–ü–æ–Ω—è—Ç–Ω–æ</button>
    </div>
</div>

<div class="bg-cloud"></div>

<!-- (–ë–õ–û–ö –° –ö–ê–†–¢–û–ß–ö–ê–ú–ò - –í–°–¢–ê–í–¨–¢–ï –°–Æ–î–ê –í–ï–°–¨ –í–ê–® <div class="layout-wrapper"> ... </div>) -->
<!-- –Ø –Ω–µ –¥—É–±–ª–∏—Ä—É—é –µ–≥–æ, —á—Ç–æ–±—ã –∫–æ–¥ –≤–ª–µ–∑ –≤ —Å–æ–æ–±—â–µ–Ω–∏–µ, –æ–Ω —É –≤–∞—Å –µ—Å—Ç—å -->
<div class="layout-wrapper">
  <!-- –í—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ –≤—Å—ë —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ layout-wrapper –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è -->
  <!-- ... –ö–æ–Ω—Ç–µ–Ω—Ç ... -->
  <!-- ... –ö–æ–Ω—Ç–µ–Ω—Ç ... -->
  
  <!-- Left Column: Options -->
  <div class="main-column">
    
    <!-- BLOCK 1: VATS -->
    <section class="card card-group">
      <div class="card-header static">
        <div class="card-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –í–ê–¢–° –∏ –Ω–æ–º–µ—Ä–æ–≤</div>
      </div>

      <div class="option-row">
        <div class="option-info">
          <div class="option-name">
            –í–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –ê–¢–°
            <span class="info-icon" onclick="openTooltip('tooltip-vats')">i</span>
          </div>
          <div class="option-meta">
            <span id="cost-VATS"></span>
            <span id="limit-VATS"></span>
          </div>
        </div>
        <div class="control-wrapper">
          <label class="toggle-switch">
            <input type="checkbox" id="VATS" onchange="runCascade('VATS')">
            <span class="slider"></span>
          </label>
        </div>
      </div>

      <div class="option-row">
        <div class="option-info">
            <div class="option-name">
                –í–ê–¢–° Pro (–º–∞–∫—Å–∏–º—É–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π)
                <span class="info-icon" onclick="openTooltip('tooltip-vatspro')">i</span>
            </div>
            <div class="option-meta">
                <span id="cost-VATSPRO"></span>
                <span id="limit-VATSPRO"></span>
            </div>
        </div>
        <div class="control-wrapper">
            <label class="toggle-switch">
                <input type="checkbox" id="VATSPRO" onchange="runCascade('VATSPRO')">
                <span class="slider"></span>
            </label>
        </div>
      </div>

      <div class="option-row">
        <div class="option-info">
            <div class="option-name">–ö–æ–ª-–≤–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –í–ê–¢–°</div>
            <div class="option-meta">
                <span id="cost-KolvoSotrudnikovVATS"></span>
                <span id="limit-KolvoSotrudnikovVATS"></span>
            </div>
        </div>
        <div class="control-wrapper">
            <div class="stepper">
                <button class="stepper-btn" onclick="stepInput('KolvoSotrudnikovVATS', -1)">‚àí</button>
                <input type="text" inputmode="numeric" class="stepper-input" id="KolvoSotrudnikovVATS" value="0" onchange="runCascade('KolvoSotrudnikovVATS')">
                <button class="stepper-btn" onclick="stepInput('KolvoSotrudnikovVATS', 1)">+</button>
            </div>
        </div>
      </div>

      <div class="option-row">
        <div class="option-info">
            <div class="option-name">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–∞–ø–∏—Å–µ–π –í–ê–¢–°</div>
            <div class="option-meta">
                <span id="cost-DlitelnostHraneniyaVATS"></span>
                <span id="limit-DlitelnostHraneniyaVATS"></span>
            </div>
        </div>
        <div class="control-wrapper">
            <div class="custom-select-trigger" onclick="openSelectModal('DlitelnostHraneniyaVATS', '–•—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π')">0</div>
            <select id="DlitelnostHraneniyaVATS" class="hidden-native-select" onchange="runCascade('DlitelnostHraneniyaVATS')">
                <option value="0">0</option>
                <option value="1 –Ω–µ–¥–µ–ª—è">1 –Ω–µ–¥–µ–ª—è</option>
                <option value="1 –º–µ—Å—è—Ü">1 –º–µ—Å—è—Ü</option>
                <option value="3 –º–µ—Å—è—Ü–∞">3 –º–µ—Å—è—Ü–∞</option>
                <option value="6 –º–µ—Å—è—Ü–µ–≤">6 –º–µ—Å—è—Ü–µ–≤</option>
                <option value="1 –≥–æ–¥">1 –≥–æ–¥</option>
                <option value="2 –≥–æ–¥–∞">2 –≥–æ–¥–∞</option>
                <option value="4 –≥–æ–¥–∞">4 –≥–æ–¥–∞</option>
            </select>
        </div>
      </div>

      <div class="option-row">
          <div class="option-info">
              <div class="option-name">–ö–æ–ª-–≤–æ –Ω–æ–º–µ—Ä–æ–≤ UIS - –ì–æ—Ä–æ–¥—Å–∫–∏–µ/–ú–æ–±–∏–ª—å–Ω—ã–µ</div>
              <div class="option-meta"><span id="cost-NomeraVATS"></span><span id="limit-NomeraVATS"></span></div>
          </div>
          <div class="control-wrapper">
              <div class="stepper">
                  <button class="stepper-btn" onclick="stepInput('NomeraVATS', -1)">‚àí</button>
                  <input type="text" inputmode="numeric" class="stepper-input" id="NomeraVATS" value="0" onchange="runCascade('NomeraVATS')">
                  <button class="stepper-btn" onclick="stepInput('NomeraVATS', 1)">+</button>
              </div>
          </div>
      </div>

      <div class="option-row">
          <div class="option-info">
              <div class="option-name">–ö–æ–ª-–≤–æ –Ω–æ–º–µ—Ä–æ–≤ UIS - 8800 <span class="info-icon" onclick="openTooltip('tooltip-8800')">i</span></div>
              <div class="option-meta"><span id="cost-NomeraVATS8800"></span><span id="limit-NomeraVATS8800"></span></div>
          </div>
          <div class="control-wrapper">
              <div class="stepper">
                  <button class="stepper-btn" onclick="stepInput('NomeraVATS8800', -1)">‚àí</button>
                  <input type="text" inputmode="numeric" class="stepper-input" id="NomeraVATS8800" value="0" onchange="runCascade('NomeraVATS8800')">
                  <button class="stepper-btn" onclick="stepInput('NomeraVATS8800', 1)">+</button>
              </div>
          </div>
      </div>
      
      <div class="option-row">
          <div class="option-info">
              <div class="option-name">–ö–æ–ª-–≤–æ c—Ç–æ—Ä–æ–Ω–Ω–∏—Ö –Ω–æ–º–µ—Ä–æ–≤ <span class="info-icon" onclick="openTooltip('tooltip-own')">i</span></div>
              <div class="option-meta"><span id="cost-KolvoSvoihNomerov"></span><span id="limit-KolvoSvoihNomerov"></span></div>
          </div>
          <div class="control-wrapper">
              <div class="stepper">
                  <button class="stepper-btn" onclick="stepInput('KolvoSvoihNomerov', -1)">‚àí</button>
                  <input type="text" inputmode="numeric" class="stepper-input" id="KolvoSvoihNomerov" value="0" onchange="runCascade('KolvoSvoihNomerov')">
                  <button class="stepper-btn" onclick="stepInput('KolvoSvoihNomerov', 1)">+</button>
              </div>
          </div>
      </div>

      <!-- TOTAL NUMBERS (Read Only) -->
      <div class="option-row">
        <div class="option-info">
            <div class="option-name">–ö–æ–ª-–≤–æ –Ω–æ–º–µ—Ä–æ–≤ UIS –≤—Å–µ–≥–æ</div>
            <div class="option-meta">
                <span id="cost-NomeraVATSVsego"></span>
                <span id="limit-NomeraVATSVsego"></span>
            </div>
        </div>
        <div class="control-wrapper">
             <div class="readonly-field">
                 <input type="text" id="NomeraVATSVsego" value="0" disabled style="background:transparent; border:none; width:30px; text-align:center; font-weight:700; color:inherit;">
                 <span style="font-size:12px; opacity:0.5">üîí</span>
             </div>
        </div>
      </div>

      <!-- FMC GROUP -->
      <div class="fmc-container">
          <div class="fmc-title">–ú–æ–±–∏–ª—å–Ω–∞—è —Å–≤—è–∑—å (FMC)</div>
          
          <div class="fmc-subgroup">
              <div class="option-row">
                  <div class="option-info">
                      <div class="option-name">–ö–æ–ª-–≤–æ —Å–∏–º –∫–∞—Ä—Ç <span class="info-icon" onclick="openTooltip('tooltip-fmc')">i</span></div>
                  </div>
                  <div class="control-wrapper">
                      <div class="stepper">
                          <button class="stepper-btn" onclick="stepInput('KolvoFMC', -1)">‚àí</button>
                          <input type="text" inputmode="numeric" class="stepper-input" id="KolvoFMC" value="0" onchange="runCascade('KolvoFMC')">
                          <button class="stepper-btn" onclick="stepInput('KolvoFMC', 1)">+</button>
                      </div>
                  </div>
              </div>

              <div class="option-row stacked">
                  <div class="option-info">
                      <div class="option-name">–¢–∞—Ä–∏—Ñ FMC —Å–∏–º –∫–∞—Ä—Ç</div>
                      <div class="option-meta"><span id="cost-TarifFMC"></span><span id="limit-TarifFMC"></span></div>
                  </div>
                  <div class="control-wrapper">
                      <div class="custom-select-trigger" onclick="openSelectModal('TarifFMC', '–¢–∞—Ä–∏—Ñ FMC')">–Ω–µ—Ç</div>
                      <select id="TarifFMC" class="hidden-native-select" onchange="runCascade('TarifFMC')">
                        <option value="–Ω–µ—Ç">–Ω–µ—Ç</option>
                        <option value="200 –º–∏–Ω—É—Ç, 1–ì–± –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞">200 –º–∏–Ω—É—Ç, 1–ì–± –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞</option>
                        <option value="600 –º–∏–Ω—É—Ç, 5–ì–± –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞">600 –º–∏–Ω—É—Ç, 5–ì–± –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞</option>
                        <option value="800 –º–∏–Ω—É—Ç, 10–ì–± –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞">800 –º–∏–Ω—É—Ç, 10–ì–± –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞</option>
                        <option value="2000 –º–∏–Ω—É—Ç, 20–ì–± –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞">2000 –º–∏–Ω—É—Ç, 20–ì–± –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞</option>
                        <option value="15 –º–∏–Ω—É—Ç, 0,2–ì–± –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞">15 –º–∏–Ω—É—Ç, 0,2–ì–± –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞</option>
                      </select>
                  </div>
              </div>
              
              <div class="fmc-cost-row">
                  <span id="cost-KolvoFMC"></span><span id="limit-KolvoFMC"></span>
              </div>
          </div>

          <div class="option-row stacked">
              <div class="option-info">
                  <div class="option-name">–†–µ–≥–∏–æ–Ω –¥–æ—Å—Ç–∞–≤–∫–∏ <span class="info-icon" onclick="openTooltip('tooltip-delivery-main')">i</span></div>
                  <div class="option-meta"><span id="cost-RegionDostavki"></span><span id="limit-RegionDostavki"></span></div>
              </div>
              <div class="control-wrapper">
                  <div class="custom-select-trigger" onclick="openSelectModal('RegionDostavki', '–†–µ–≥–∏–æ–Ω –¥–æ—Å—Ç–∞–≤–∫–∏')">–Ω–µ—Ç</div>
                  <select id="RegionDostavki" class="hidden-native-select" onchange="runCascade('RegionDostavki')">
                    <option value="–Ω–µ—Ç">–Ω–µ—Ç</option>
                    <option value="–ú–æ—Å–∫–≤–∞ –∏ –º—Å–∫. –æ–±–ª.">–ú–æ—Å–∫–≤–∞ –∏ –º—Å–∫. –æ–±–ª.</option>
                    <option value="–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥ –∏ –ª–µ–Ω. –æ–±–ª.">–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥ –∏ –ª–µ–Ω. –æ–±–ª.</option>
                    <option value="–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –†–æ—Å—Å–∏—è, –ü–æ–≤–æ–ª–∂—å–µ">–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –†–æ—Å—Å–∏—è, –ü–æ–≤–æ–ª–∂—å–µ</option>
                    <option value="–Æ–≥, –£—Ä–∞–ª, –°–∏–±–∏—Ä—å">–Æ–≥, –£—Ä–∞–ª, –°–∏–±–∏—Ä—å</option>
                    <option value="–î–∞–ª—å–Ω–∏–π –í–æ—Å—Ç–æ–∫">–î–∞–ª—å–Ω–∏–π –í–æ—Å—Ç–æ–∫</option>
                  </select>
              </div>
          </div>
          
          <div class="fmc-cost-row">
              <span id="cost-RegionDostavki-placeholder"></span>
          </div>
      </div>
      
      <!-- EXPERT TOGGLE -->
      <div style="text-align:center;">
          <div class="expert-toggle-btn" onclick="toggleExpert()">
              <span>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏ –í–ê–¢–°</span>
              <div class="toggle-icon"></div>
          </div>
      </div>

      <!-- Expert Block -->
      <div id="block-expert" class="expert-block card-group" style="display: none;">
          <div class="option-row">
            <div class="option-info">
                <div class="option-name">–ö–æ–ª-–≤–æ –ª–∏–Ω–∏–π –≥—Ä—É–ø–ø–æ–≤–æ–≥–æ –≤—ã–∑–æ–≤–∞</div>
                <div class="option-meta"><span id="cost-LiniyGrupovogoVizova"></span><span id="limit-LiniyGrupovogoVizova"></span></div>
            </div>
            <div class="control-wrapper">
                <div class="stepper">
                    <button class="stepper-btn" onclick="stepInput('LiniyGrupovogoVizova', -1)">‚àí</button>
                    <input type="text" inputmode="numeric" class="stepper-input" id="LiniyGrupovogoVizova" value="0" onchange="runCascade('LiniyGrupovogoVizova')">
                    <button class="stepper-btn" onclick="stepInput('LiniyGrupovogoVizova', 1)">+</button>
                </div>
            </div>
          </div>
           <div class="option-row">
            <div class="option-info">
                <div class="option-name">–ö–æ–ª-–≤–æ –ª–∏–Ω–∏–π –∏—Å—Ö–æ–¥—è—â–∏—Ö –∑–≤–æ–Ω–∫–æ–≤</div>
                <div class="option-meta"><span id="cost-LiniyIshodyashihZvonkov"></span><span id="limit-LiniyIshodyashihZvonkov"></span></div>
            </div>
            <div class="control-wrapper">
                <div class="stepper">
                    <button class="stepper-btn" onclick="stepInput('LiniyIshodyashihZvonkov', -1)">‚àí</button>
                    <input type="text" inputmode="numeric" class="stepper-input" id="LiniyIshodyashihZvonkov" value="0" onchange="runCascade('LiniyIshodyashihZvonkov')">
                    <button class="stepper-btn" onclick="stepInput('LiniyIshodyashihZvonkov', 1)">+</button>
                </div>
            </div>
          </div>
          <div class="option-row">
            <div class="option-info">
                <div class="option-name">–ö–æ–ª-–≤–æ SIP-—Ç—Ä–∞–Ω–∫–æ–≤</div>
                <div class="option-meta"><span id="cost-KolvoSIPTrankov"></span><span id="limit-KolvoSIPTrankov"></span></div>
            </div>
            <div class="control-wrapper">
                <div class="stepper">
                    <button class="stepper-btn" onclick="stepInput('KolvoSIPTrankov', -1)">‚àí</button>
                    <input type="text" inputmode="numeric" class="stepper-input" id="KolvoSIPTrankov" value="0" onchange="runCascade('KolvoSIPTrankov')">
                    <button class="stepper-btn" onclick="stepInput('KolvoSIPTrankov', 1)">+</button>
                </div>
            </div>
          </div>
          <div class="option-row">
            <div class="option-info">
                <div class="option-name">–ö–∞–Ω–∞–ª—å–Ω–æ—Å—Ç—å SIP-—Ç—Ä–∞–Ω–∫–æ–≤</div>
                <div class="option-meta"><span id="cost-KanalnostSIPTrankov"></span><span id="limit-KanalnostSIPTrankov"></span></div>
            </div>
            <div class="control-wrapper">
                <div class="custom-select-trigger" onclick="openSelectModal('KanalnostSIPTrankov', '–ö–∞–Ω–∞–ª—å–Ω–æ—Å—Ç—å SIP')">0</div>
                <select id="KanalnostSIPTrankov" class="hidden-native-select" onchange="runCascade('KanalnostSIPTrankov')">
                    <option value="0">0</option>
                    <option value="30">30</option>
                    <option value="60">60</option>
                    <option value="90">90</option>
                    <option value="180">180</option>
                </select>
            </div>
          </div>
          <div class="option-row">
            <div class="option-info">
                <div class="option-name">–ö–æ–ª-–≤–æ SIPURI</div>
                <div class="option-meta"><span id="cost-KolvoSIPURI"></span><span id="limit-KolvoSIPURI"></span></div>
            </div>
            <div class="control-wrapper">
                <div class="stepper">
                    <button class="stepper-btn" onclick="stepInput('KolvoSIPURI', -1)">‚àí</button>
                    <input type="text" inputmode="numeric" class="stepper-input" id="KolvoSIPURI" value="0" onchange="runCascade('KolvoSIPURI')">
                    <button class="stepper-btn" onclick="stepInput('KolvoSIPURI', 1)">+</button>
                </div>
            </div>
          </div>
          <div class="option-row">
            <div class="option-info">
                <div class="option-name">–ö–æ–ª-–≤–æ SIP-–∞–∫–∫–∞—É–Ω—Ç–æ–≤</div>
                <div class="option-meta"><span id="cost-KolvoSIPAkkauntov"></span><span id="limit-KolvoSIPAkkauntov"></span></div>
            </div>
            <div class="control-wrapper">
                <div class="stepper">
                    <button class="stepper-btn" onclick="stepInput('KolvoSIPAkkauntov', -1)">‚àí</button>
                    <input type="text" inputmode="numeric" class="stepper-input" id="KolvoSIPAkkauntov" value="0" onchange="runCascade('KolvoSIPAkkauntov')">
                    <button class="stepper-btn" onclick="stepInput('KolvoSIPAkkauntov', 1)">+</button>
                </div>
            </div>
          </div>
          <div class="option-row">
            <div class="option-info">
                <div class="option-name">–ö–∞–Ω–∞–ª—å–Ω–æ—Å—Ç—å SIP-–∞–∫–∫–∞—É–Ω—Ç–æ–≤</div>
                <div class="option-meta"><span id="cost-KanalnostSIPAkkauntov"></span><span id="limit-KanalnostSIPAkkauntov"></span></div>
            </div>
            <div class="control-wrapper">
                <div class="custom-select-trigger" onclick="openSelectModal('KanalnostSIPAkkauntov', '–ö–∞–Ω–∞–ª—å–Ω–æ—Å—Ç—å SIP-–∞–∫–∫')">0</div>
                <select id="KanalnostSIPAkkauntov" class="hidden-native-select" onchange="runCascade('KanalnostSIPAkkauntov')">
                    <option value="0">0</option>
                    <option value="30">30</option>
                    <option value="60">60</option>
                    <option value="90">90</option>
                    <option value="180">180</option>
                </select>
            </div>
          </div>
      </div>
    </section>

    <!-- BLOCK 2: OMNI -->
    <section class="card card-group">
        <div class="card-header static">
            <div class="card-title">–û–ú–ù–ò –ß–∞—Ç—ã</div>
        </div>

        <div class="option-row">
            <div class="option-info">
                <div class="option-name">–û–ú–ù–ò –ß–∞—Ç—ã</div>
                <div class="option-meta"><span id="cost-OMNI"></span><span id="limit-OMNI"></span></div>
            </div>
            <div class="control-wrapper">
                <label class="toggle-switch">
                    <input type="checkbox" id="OMNI" onchange="runCascade('OMNI')">
                    <span class="slider"></span>
                </label>
            </div>
        </div>

        <div class="option-row">
            <div class="option-info">
                <div class="option-name">–ö–æ–ª-–≤–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –û–ú–ù–ò –ß–∞—Ç—ã</div>
                <div class="option-meta"><span id="cost-KolvoSotrudnikovOMNI"></span><span id="limit-KolvoSotrudnikovOMNI"></span></div>
            </div>
            <div class="control-wrapper">
                <div class="stepper">
                    <button class="stepper-btn" onclick="stepInput('KolvoSotrudnikovOMNI', -1)">‚àí</button>
                    <input type="text" inputmode="numeric" class="stepper-input" id="KolvoSotrudnikovOMNI" value="0" onchange="runCascade('KolvoSotrudnikovOMNI')">
                    <button class="stepper-btn" onclick="stepInput('KolvoSotrudnikovOMNI', 1)">+</button>
                </div>
            </div>
        </div>

        <div class="option-row">
            <div class="option-info">
                <div class="option-name">–ö–æ–ª-–≤–æ WhatsApp –∞–∫–∫–∞—É–Ω—Ç–æ–≤</div>
                <div class="option-meta"><span id="cost-KolvoWA"></span><span id="limit-KolvoWA"></span></div>
            </div>
            <div class="control-wrapper">
                <div class="stepper">
                    <button class="stepper-btn" onclick="stepInput('KolvoWA', -1)">‚àí</button>
                    <input type="text" inputmode="numeric" class="stepper-input" id="KolvoWA" value="0" onchange="runCascade('KolvoWA')">
                    <button class="stepper-btn" onclick="stepInput('KolvoWA', 1)">+</button>
                </div>
            </div>
        </div>

        <div class="option-row">
            <div class="option-info">
                <div class="option-name">–ö–æ–ª-–≤–æ –∫–∞–Ω–∞–ª–æ–≤ WABA <span class="info-icon" onclick="openTooltip('tooltip-waba')">i</span></div>
                <div class="option-meta"><span id="cost-KolvoWABA"></span><span id="limit-KolvoWABA"></span></div>
            </div>
            <div class="control-wrapper">
                <div class="stepper">
                    <button class="stepper-btn" onclick="stepInput('KolvoWABA', -1)">‚àí</button>
                    <input type="text" inputmode="numeric" class="stepper-input" id="KolvoWABA" value="0" onchange="runCascade('KolvoWABA')">
                    <button class="stepper-btn" onclick="stepInput('KolvoWABA', 1)">+</button>
                </div>
            </div>
        </div>

        <div class="option-row">
            <div class="option-info">
                <div class="option-name">Telegram, Tg Bot, VK Groups, –ê–≤–∏—Ç–æ –∏ –¥—Ä.</div>
                <div class="option-meta"><span id="cost-TgVkAvito"></span><span id="limit-TgVkAvito"></span></div>
            </div>
            <div class="control-wrapper">
                <label class="toggle-switch">
                    <input type="checkbox" id="TgVkAvito" onchange="runCascade('TgVkAvito')">
                    <span class="slider"></span>
                </label>
            </div>
        </div>
        
        <div class="option-row">
            <div class="option-info">
                <div class="option-name">–û–ú–ù–ò –≤–∏–¥–∂–µ—Ç –Ω–∞ —Å–∞–π—Ç <span class="info-icon" onclick="openTooltip('tooltip-omniknopka')">i</span></div>
                <div class="option-meta"><span id="cost-OMNIKnopka"></span><span id="limit-OMNIKnopka"></span></div>
            </div>
            <div class="control-wrapper">
                <label class="toggle-switch">
                    <input type="checkbox" id="OMNIKnopka" onchange="runCascade('OMNIKnopka')">
                    <span class="slider"></span>
                </label>
            </div>
        </div>
    </section>

    <!-- BLOCK 3: Analytics -->
    <section class="card card-group">
        <div class="card-header collapsed" onclick="toggleAnalytics()">
            <div class="card-title">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —Ä–µ–∫–ª–∞–º—ã</div>
            <div class="header-toggle-icon"></div>
        </div>
        
        <div id="block-ar" style="display:none;">
             <div class="option-row">
                <div class="option-info">
                    <div class="option-name">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —Ä–µ–∫–ª–∞–º—ã <span class="info-icon" onclick="openTooltip('tooltip-ar')">i</span></div>
                    <div class="option-meta"><span id="cost-AR"></span><span id="limit-AR"></span></div>
                </div>
                <div class="control-wrapper">
                    <label class="toggle-switch">
                        <input type="checkbox" id="AR" onchange="runCascade('AR')">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>

            <div class="option-row">
                <div class="option-info">
                    <div class="option-name">–ö–æ–ª-–≤–æ —Å–∞–π—Ç–æ–≤</div>
                    <div class="option-meta"><span id="cost-KolvoSaitov"></span><span id="limit-KolvoSaitov"></span></div>
                </div>
                <div class="control-wrapper">
                    <div class="stepper">
                        <button class="stepper-btn" onclick="stepInput('KolvoSaitov', -1)">‚àí</button>
                        <input type="text" inputmode="numeric" class="stepper-input" id="KolvoSaitov" value="0" onchange="runCascade('KolvoSaitov')">
                        <button class="stepper-btn" onclick="stepInput('KolvoSaitov', 1)">+</button>
                    </div>
                </div>
            </div>

            <div class="option-row">
                <div class="option-info">
                    <div class="option-name">–ö–æ–ª-–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤</div>
                    <div class="option-meta"><span id="cost-KolvoPolzovatelskihIstochnikov"></span><span id="limit-KolvoPolzovatelskihIstochnikov"></span></div>
                </div>
                <div class="control-wrapper">
                     <div class="custom-select-trigger" onclick="openSelectModal('KolvoPolzovatelskihIstochnikov', '–ü–æ–ª—å–∑. –∏—Å—Ç–æ—á–Ω–∏–∫–∏')">0</div>
                     <select id="KolvoPolzovatelskihIstochnikov" class="hidden-native-select" onchange="runCascade('KolvoPolzovatelskihIstochnikov')">
                      <option value="0">0</option>
                      <option value="50">50</option>
                      <option value="250">250</option>
                      <option value="500">500</option>
                      <option value="5000">5000</option>
                    </select>
                </div>
            </div>

             <div class="option-row">
                <div class="option-info">
                    <div class="option-name">–ü–∞–∫–µ—Ç —Ç—Ä–∞—Ñ–∏–∫–∞ <span class="info-icon" onclick="openTooltip('tooltip-traffic')">i</span></div>
                    <div class="option-meta"><span id="cost-PaketTrafika"></span><span id="limit-PaketTrafika"></span></div>
                </div>
                <div class="control-wrapper">
                    <div class="custom-select-trigger" onclick="openSelectModal('PaketTrafika', '–ü–∞–∫–µ—Ç —Ç—Ä–∞—Ñ–∏–∫–∞')">0</div>
                    <select id="PaketTrafika" class="hidden-native-select" onchange="runCascade('PaketTrafika')">
                      <option value="0">0</option>
                      <option value="10000">10000</option>
                      <option value="20000">20000</option>
                      <option value="50000">50000</option>
                      <option value="100000">100000</option>
                      <option value="200000">200000</option>
                      <option value="500000">500000</option>
                      <option value="–±–µ–∑–ª–∏–º–∏—Ç">–±–µ–∑–ª–∏–º–∏—Ç</option>
                    </select>
                </div>
            </div>

            <div class="option-row">
                <div class="option-info">
                    <div class="option-name">–ö–æ–ª–ª—Ç—Ä–µ–∫–∏–Ω–≥ <span class="info-icon" onclick="openTooltip('tooltip-kt')">i</span></div>
                    <div class="option-meta"><span id="cost-KT"></span><span id="limit-KT"></span></div>
                </div>
                <div class="control-wrapper">
                    <label class="toggle-switch">
                        <input type="checkbox" id="KT" onchange="runCascade('KT')">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>

             <div class="option-row">
                <div class="option-info">
                    <div class="option-name">–ö–æ–ª-–≤–æ –Ω–æ–º–µ—Ä–æ–≤ –ö–¢ - –ì–æ—Ä–æ–¥—Å–∫–∏–µ/–ú–æ–±–∏–ª—å–Ω—ã–µ</div>
                    <div class="option-meta"><span id="cost-NomeraKT"></span><span id="limit-NomeraKT"></span></div>
                </div>
                <div class="control-wrapper">
                    <div class="stepper">
                        <button class="stepper-btn" onclick="stepInput('NomeraKT', -1)">‚àí</button>
                        <input type="text" inputmode="numeric" class="stepper-input" id="NomeraKT" value="0" onchange="runCascade('NomeraKT')">
                        <button class="stepper-btn" onclick="stepInput('NomeraKT', 1)">+</button>
                    </div>
                </div>
            </div>
             <div class="option-row">
                <div class="option-info">
                    <div class="option-name">–ö–æ–ª-–≤–æ –Ω–æ–º–µ—Ä–æ–≤ –ö–¢ - 8800 <span class="info-icon" onclick="openTooltip('tooltip-8800')">i</span></div>
                    <div class="option-meta"><span id="cost-NomeraKT8800"></span><span id="limit-NomeraKT8800"></span></div>
                </div>
                <div class="control-wrapper">
                    <div class="stepper">
                        <button class="stepper-btn" onclick="stepInput('NomeraKT8800', -1)">‚àí</button>
                        <input type="text" inputmode="numeric" class="stepper-input" id="NomeraKT8800" value="0" onchange="runCascade('NomeraKT8800')">
                        <button class="stepper-btn" onclick="stepInput('NomeraKT8800', 1)">+</button>
                    </div>
                </div>
            </div>

             <div class="option-row">
                <div class="option-info">
                    <div class="option-name">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–∞–ø–∏—Å–µ–π –ö–¢</div>
                    <div class="option-meta"><span id="cost-DlitelnostHraneniyaAR"></span><span id="limit-DlitelnostHraneniyaAR"></span></div>
                </div>
                <div class="control-wrapper">
                    <div class="custom-select-trigger" onclick="openSelectModal('DlitelnostHraneniyaAR', '–•—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π –ö–¢')">0</div>
                    <select id="DlitelnostHraneniyaAR" class="hidden-native-select" onchange="runCascade('DlitelnostHraneniyaAR')">
                      <option value="0">0</option>
                      <option value="1 –Ω–µ–¥–µ–ª—è">1 –Ω–µ–¥–µ–ª—è</option>
                      <option value="1 –º–µ—Å—è—Ü">1 –º–µ—Å—è—Ü</option>
                      <option value="3 –º–µ—Å—è—Ü–∞">3 –º–µ—Å—è—Ü–∞</option>
                      <option value="6 –º–µ—Å—è—Ü–µ–≤">6 –º–µ—Å—è—Ü–µ–≤</option>
                      <option value="1 –≥–æ–¥">1 –≥–æ–¥</option>
                      <option value="2 –≥–æ–¥–∞">2 –≥–æ–¥–∞</option>
                      <option value="4 –≥–æ–¥–∞">4 –≥–æ–¥–∞</option>
                    </select>
                </div>
            </div>

             <div class="option-row">
                <div class="option-info">
                    <div class="option-name">Email-—Ç—Ä–µ–∫–∏–Ω–≥ (–∫–æ–ª-–≤–æ –ø–∏—Å–µ–º –≤ –º–µ—Å—è—Ü)</div>
                    <div class="option-meta"><span id="cost-EmailTreking"></span><span id="limit-EmailTreking"></span></div>
                </div>
                <div class="control-wrapper">
                     <div class="custom-select-trigger" onclick="openSelectModal('EmailTreking', 'Email-—Ç—Ä–µ–∫–∏–Ω–≥')">–Ω–µ—Ç</div>
                     <select id="EmailTreking" class="hidden-native-select" onchange="runCascade('EmailTreking')">
                      <option value="–Ω–µ—Ç">–Ω–µ—Ç</option>
                      <option value="–¥–æ 100 —à—Ç.">–¥–æ 100 —à—Ç.</option>
                      <option value="–±–æ–ª—å—à–µ 100 —à—Ç.">–±–æ–ª—å—à–µ 100 —à—Ç.</option>
                    </select>
                </div>
            </div>

            <div class="option-row">
                <div class="option-info">
                    <div class="option-name">–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –æ—Ç—á–µ—Ç–æ–≤ <span class="info-icon" onclick="openTooltip('tooltip-report')">i</span></div>
                    <div class="option-meta"><span id="cost-KonstruktorOtchetov"></span><span id="limit-KonstruktorOtchetov"></span></div>
                </div>
                <div class="control-wrapper">
                    <label class="toggle-switch">
                        <input type="checkbox" id="KonstruktorOtchetov" onchange="runCascade('KonstruktorOtchetov')">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
            
            <div class="option-row">
                <div class="option-info">
                    <div class="option-name">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø—Ä–æ–¥–∞–∂ –∏–∑ CRM <span class="info-icon" onclick="openTooltip('tooltip-crm')">i</span></div>
                    <div class="option-meta"><span id="cost-AnalitikaProdaj"></span><span id="limit-AnalitikaProdaj"></span></div>
                </div>
                <div class="control-wrapper">
                    <label class="toggle-switch">
                        <input type="checkbox" id="AnalitikaProdaj" onchange="runCascade('AnalitikaProdaj')">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>

            <div class="option-row">
                <div class="option-info">
                    <div class="option-name">–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–∏–¥–∂–µ—Ç–∞–º–∏ <span class="info-icon" onclick="openTooltip('tooltip-widget')">i</span></div>
                    <div class="option-meta"><span id="cost-IntegraciyaSVidjetami"></span><span id="limit-IntegraciyaSVidjetami"></span></div>
                </div>
                <div class="control-wrapper">
                    <label class="toggle-switch">
                        <input type="checkbox" id="IntegraciyaSVidjetami" onchange="runCascade('IntegraciyaSVidjetami')">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>

        </div>
    </section>

    <!-- BLOCK 4: Integrations -->
     <section class="card card-group">
        <div class="card-header static">
            <div class="card-title">–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∏ –¥–æ–ø. –æ–ø—Ü–∏–∏</div>
        </div>

        <div class="option-row">
            <div class="option-info">
                <div class="option-name">–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å amoCRM –∏–ª–∏ –ë–∏—Ç—Ä–∏–∫—Å 24</div>
                <div class="option-meta"><span id="cost-AmoBitrix"></span><span id="limit-AmoBitrix"></span></div>
            </div>
            <div class="control-wrapper">
                <label class="toggle-switch">
                    <input type="checkbox" id="AmoBitrix" onchange="runCascade('AmoBitrix')">
                    <span class="slider"></span>
                </label>
            </div>
        </div>

        <div class="option-row">
            <div class="option-info">
                <div class="option-name">–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –æ—Ç—Ä–∞—Å–ª–µ–≤—ã–º–∏ CRM <span class="info-icon" onclick="openTooltip('tooltip-otrasl')">i</span></div>
                <div class="option-meta"><span id="cost-IntegraciyaOtraslevie"></span><span id="limit-IntegraciyaOtraslevie"></span></div>
            </div>
            <div class="control-wrapper">
                <label class="toggle-switch">
                    <input type="checkbox" id="IntegraciyaOtraslevie" onchange="runCascade('IntegraciyaOtraslevie')">
                    <span class="slider"></span>
                </label>
            </div>
        </div>

        <div class="option-row">
            <div class="option-info">
                <div class="option-name">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–æ–±—ã—Ç–∏—è—Ö <span class="info-icon" onclick="openTooltip('tooltip-notify')">i</span></div>
                <div class="option-meta"><span id="cost-UvedomlenieOSobitiyah"></span><span id="limit-UvedomlenieOSobitiyah"></span></div>
            </div>
            <div class="control-wrapper">
                <label class="toggle-switch">
                    <input type="checkbox" id="UvedomlenieOSobitiyah" onchange="runCascade('UvedomlenieOSobitiyah')">
                    <span class="slider"></span>
                </label>
            </div>
        </div>

        <div class="option-row">
            <div class="option-info">
                <div class="option-name">–í–Ω–µ—à–Ω–∏–µ –ê–¢–° <span class="info-icon" onclick="openTooltip('tooltip-ats')">i</span></div>
                <div class="option-meta"><span id="cost-VneshnieATS"></span><span id="limit-VneshnieATS"></span></div>
            </div>
            <div class="control-wrapper">
                <label class="toggle-switch">
                    <input type="checkbox" id="VneshnieATS" onchange="runCascade('VneshnieATS')">
                    <span class="slider"></span>
                </label>
            </div>
        </div>

        <div class="option-row">
            <div class="option-info">
                <div class="option-name">–°–ø–∞—Å–µ–Ω–∏–µ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–π <span class="info-icon" onclick="openTooltip('tooltip-save')">i</span></div>
                <div class="option-meta"><span id="cost-SpasenieKommunikatsiy"></span><span id="limit-SpasenieKommunikatsiy"></span></div>
            </div>
            <div class="control-wrapper">
                <label class="toggle-switch">
                    <input type="checkbox" id="SpasenieKommunikatsiy" onchange="runCascade('SpasenieKommunikatsiy')">
                    <span class="slider"></span>
                </label>
            </div>
        </div>
        
        <div class="option-row">
            <div class="option-info">
                <div class="option-name">–ê–≤—Ç–æ–ø–µ—Ä–µ–∑–≤–æ–Ω –ø–æ –∑–∞—è–≤–∫–∞–º —Å —Å–∞–π—Ç–∞</div>
                <div class="option-meta"><span id="cost-AvtoperezvonPoZayavkam"></span><span id="limit-AvtoperezvonPoZayavkam"></span></div>
            </div>
            <div class="control-wrapper">
                <label class="toggle-switch">
                    <input type="checkbox" id="AvtoperezvonPoZayavkam" onchange="runCascade('AvtoperezvonPoZayavkam')">
                    <span class="slider"></span>
                </label>
            </div>
        </div>

        <div class="option-row">
            <div class="option-info">
                <div class="option-name">–í–µ–∑–¥–µ –∫–∞–∫ –¥–æ–º–∞ <span class="info-icon" onclick="openTooltip('tooltip-home')">i</span></div>
                <div class="option-meta"><span id="cost-VezdeKakDoma"></span><span id="limit-VezdeKakDoma"></span></div>
            </div>
            <div class="control-wrapper">
                <label class="toggle-switch">
                    <input type="checkbox" id="VezdeKakDoma" onchange="runCascade('VezdeKakDoma')">
                    <span class="slider"></span>
                </label>
            </div>
        </div>
    </section>

  </div> <!-- End Main Column -->
  
  <!-- Right Column: Sticky Sidebar (Desktop Only) -->
  <div class="sidebar-column">
    <!-- –ò—Ç–æ–≥–∏ -->
    <!-- ... (–∫–æ–¥ —Å–∞–π–¥–±–∞—Ä–∞ –∏ –º–æ–¥–∞–ª–æ–∫ –æ—Å—Ç–∞–ª—Å—è —Ç–µ–º –∂–µ) ... -->
    <div class="summary-card">
      <div class="summary-total">
        <div class="summary-total-label">–ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –ø–ª–∞—Ç—ë–∂</div>
        <div class="summary-total-value">
          <span id="total-monthly">0</span> <span class="summary-currency">‚ÇΩ / –º–µ—Å</span>
        </div>
      </div>
      
      <div class="summary-details">
        <div class="summary-row">
          <span>–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Å—á–µ—Ç –Ω–∞ —Å–≤—è–∑—å <span class="info-icon" onclick="openTooltip('tooltip-min8800')" style="background:rgba(255,255,255,0.2);color:white">i</span></span>
          <span id="total-minimal">0</span>
        </div>
        <div class="summary-row">
          <span>–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –Ω–æ–º–µ—Ä–æ–≤ <span class="info-icon" onclick="openTooltip('tooltip-connect')" style="background:rgba(255,255,255,0.2);color:white">i</span></span>
          <span id="total-connection">0</span>
        </div>
        <div class="summary-row">
          <span>–î–æ—Å—Ç–∞–≤–∫–∞ FMC-—Å–∏–º –∫–∞—Ä—Ç <span class="info-icon" onclick="openTooltip('tooltip-delivery')" style="background:rgba(255,255,255,0.2);color:white">i</span></span>
          <span id="total-delivery">0</span>
        </div>
        <div class="summary-row">
          <span>–ì–∞—Ä–∞–Ω—Ç–∏–π–Ω—ã–π –≤–∑–Ω–æ—Å <span class="info-icon" onclick="openTooltip('tooltip-guarantee')" style="background:rgba(255,255,255,0.2);color:white">i</span></span>
          <span id="total-guarantee">0</span>
        </div>
      </div>

      <div class="button-group">
          <button class="btn-reset" onclick="resetForm()">–°—Ç–µ—Ä–µ—Ç—å —Ä–∞—Å—á–µ—Ç</button>
          <button class="btn-print" onclick="openManagerModal()">–ü–µ—á–∞—Ç—å –ö–ü</button>
      </div>
    </div>
  </div>

</div>

<!-- MOBILE BOTTOM SHEET -->
<div class="bottom-sheet" id="mobileSheet">
    <div class="sheet-header" onclick="toggleSheet()">
        <div class="sheet-main-info">
            <div class="sheet-label">–ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –ø–ª–∞—Ç–µ–∂</div>
            <div class="sheet-price"><span id="mobile-total">0</span></div>
        </div>
        <div class="sheet-icon">‚ñ≤</div>
    </div>
    <div class="sheet-content">
        <div class="sheet-row">
            <span>–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Å—á–µ—Ç –Ω–∞ —Å–≤—è–∑—å <span class="info-icon" onclick="openTooltip('tooltip-min8800')">i</span></span>
            <span id="mobile-minimal">0</span>
        </div>
        <div class="sheet-row">
            <span>–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –Ω–æ–º–µ—Ä–æ–≤ <span class="info-icon" onclick="openTooltip('tooltip-connect')">i</span></span>
            <span id="mobile-connection">0</span>
        </div>
        <div class="sheet-row">
            <span>–î–æ—Å—Ç–∞–≤–∫–∞ FMC-—Å–∏–º –∫–∞—Ä—Ç <span class="info-icon" onclick="openTooltip('tooltip-delivery')">i</span></span>
            <span id="mobile-delivery">0</span>
        </div>
        <div class="sheet-row">
            <span>–ì–∞—Ä–∞–Ω—Ç–∏–π–Ω—ã–π –≤–∑–Ω–æ—Å <span class="info-icon" onclick="openTooltip('tooltip-guarantee')">i</span></span>
            <span id="mobile-guarantee">0</span>
        </div>
        <button class="sheet-reset" onclick="resetForm(); toggleSheet()">–°—Ç–µ—Ä–µ—Ç—å —Ä–∞—Å—á–µ—Ç</button>
        <button class="btn-manager-print" style="background:#0000aa; color:white; margin-top:10px;" onclick="openManagerModal()">–ü–µ—á–∞—Ç—å –ö–ü</button>
    </div>
</div>

<!-- INFO MODAL -->
<div class="modal-overlay" id="modalOverlay" onclick="closeModal(event)">
    <div class="modal-content">
        <span class="modal-close" onclick="closeModal(event, true)">&times;</span>
        <div class="modal-text" id="modalText"></div>
    </div>
</div>

<!-- MANAGER MODAL -->
<div class="modal-overlay" id="managerModal" onclick="closeManagerModal(event)">
    <div class="modal-content">
        <span class="modal-close" onclick="closeManagerModal(event, true)">&times;</span>
        <span class="modal-title">–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</span>
        <div class="manager-form">
            <div class="form-group">
                <label>–§–ò–û –ú–µ–Ω–µ–¥–∂–µ—Ä–∞</label>
                <input type="text" id="mgrName" placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á" oninput="formatName(this)">
            </div>
            <div class="form-group">
                <label>–¢–µ–ª–µ—Ñ–æ–Ω</label>
                <input type="text" id="mgrPhone" placeholder="+7 (999) 999-99-99" oninput="formatPhone(this)">
            </div>
            <div class="form-group">
                <label>Email</label>
                <input type="email" id="mgrEmail" placeholder="manager@uiscom.ru" onblur="validateEmail(this)" oninput="this.classList.remove('invalid'); this.value = this.value.replace(/[^a-zA-Z0-9@._-]/g, '');">
            </div>
            <button type="button" class="btn-manager-print" onclick="printKP()">–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –∏ –Ω–∞–ø–µ—á–∞—Ç–∞—Ç—å</button>
        </div>
    </div>
</div>

<!-- SELECT MODAL -->
<div class="modal-overlay" id="selectModalOverlay" onclick="closeSelectModal(event)">
    <div class="modal-content">
        <span class="modal-close" onclick="closeSelectModal(event, true)">&times;</span>
        <span class="modal-title" id="selectModalTitle">–í—ã–±–æ—Ä</span>
        <div class="modal-options-list" id="selectModalOptions">
            <!-- Options injected by JS -->
        </div>
    </div>
</div>

<!-- HIDDEN PRINT AREA -->
<div id="print-area">
    <div class="print-header">
        <div class="print-logo">UIS</div>
        <div class="print-title">–ö–æ–º–º–µ—Ä—á–µ—Å–∫–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ</div>
    </div>
    
    <div id="print-manager-block" class="print-manager" style="display:none;">
        <h3>–í–∞—à –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä:</h3>
        <p id="print-mgr-name"></p>
        <p id="print-mgr-phone"></p>
        <p id="print-mgr-email"></p>
    </div>

    <div id="print-sections-container">
        <!-- Sections populated by JS -->
    </div>
    
    <!-- Totals Block - At the bottom -->
    <div class="print-totals">
        <div class="print-total-row main">
            <span class="label">–ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –ø–ª–∞—Ç—ë–∂</span>
            <span class="value" id="print-total-monthly">0 ‚ÇΩ</span>
        </div>
        <div class="print-total-row">
            <div>
                <span>–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Å—á–µ—Ç –Ω–∞ —Å–≤—è–∑—å</span>
                <span class="print-total-helper" id="print-total-minimal-desc">–†–∞—Å—Ö–æ–¥—É–µ—Ç—Å—è –Ω–∞ –∑–≤–æ–Ω–∫–∏ —Å –Ω–æ–º–µ—Ä–∞–º–∏ 8-800</span>
            </div>
            <span id="print-total-minimal">0 ‚ÇΩ</span>
        </div>
        <div class="print-total-row">
            <div>
                <span>–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –Ω–æ–º–µ—Ä–æ–≤</span>
                <span class="print-total-helper">–†–∞–∑–æ–≤–æ –∑–∞ –ø–æ–¥–∫–ª—é—á–∞–µ–º—ã–µ –Ω–æ–º–µ—Ä–∞ –∏/–∏–ª–∏ FMC-—Å–∏–º –∫–∞—Ä—Ç—ã</span>
            </div>
            <span id="print-total-connection">0 ‚ÇΩ</span>
        </div>
        <div class="print-total-row">
            <div>
                <span>–î–æ—Å—Ç–∞–≤–∫–∞ FMC-—Å–∏–º –∫–∞—Ä—Ç</span>
                <span class="print-total-helper">–†–∞–∑–æ–≤–æ –∑–∞ –æ–¥–∏–Ω –∞–¥—Ä–µ—Å</span>
            </div>
            <span id="print-total-delivery">0 ‚ÇΩ</span>
        </div>
        <div class="print-total-row" style="margin-top:15px; padding-top:15px; border-top:1px solid #ddd;">
            <div>
                <span>–ì–∞—Ä–∞–Ω—Ç–∏–π–Ω—ã–π –≤–∑–Ω–æ—Å</span>
                <span class="print-total-helper" id="print-total-guarantee-desc"></span>
            </div>
            <span id="print-total-guarantee" style="font-weight:700">0 ‚ÇΩ</span>
        </div>
    </div>

    <div class="print-social">
        <div class="print-social-title"></div>
        <div class="print-social-list">
            <a href="https://t.me/uis_technology" target="_blank" class="print-social-link"><span>–û–ø–µ—Ä–∞—Ç–∏–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</span></a>
            <a href="https://t.me/uiscom_ru" target="_blank" class="print-social-link"><span>UIS –≥–æ–≤–æ—Ä–∏—Ç</span></a>
            <a href="https://vk.com/uiscom" target="_blank" class="print-social-link"><span>–í–ö–æ–Ω—Ç–∞–∫—Ç–µ</span></a>
            <a href="https://vc.ru/uiscom" target="_blank" class="print-social-link"><span>–ë–ª–æ–≥ –Ω–∞ VC.ru</span></a>
            <a href="https://rutube.ru/channel/24800224/" target="_blank" class="print-social-link"><span>RUTUBE</span></a>
            <a href="https://dzen.ru/id/5d4a870ef2df2500ae39c4ad?share_to=link" target="_blank" class="print-social-link"><span>–î–∑–µ–Ω</span></a>
        </div>
    </div>
</div>

<!-- Tooltip Content Storage (Hidden) -->
<div class="tooltip-content-hidden">
    <div id="tooltip-vats">–ë–∞–∑–æ–≤—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤:<br>- –∏–Ω—Ñ. —Å–æ–æ–±—â–µ–Ω–∏–µ<br>- –º–µ–Ω—é<br>- –ø–µ—Ä–µ–∞–¥—Ä–µ—Å–∞—Ü–∏—è –Ω–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –∏ –≥—Ä—É–ø–ø—É<br>- —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –≥—Ä–∞—Ñ–∏–∫–∞–º<br>- —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–≥–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –∏–∑ CRM<br><br>–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–≤–æ–Ω–∫–æ–≤:<br>- –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É<br>- –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ<br><br>–î–æ 3 –Ω–æ–º–µ—Ä–æ–≤ —É —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ (—Å–∏–ø/–ª–∏—á–Ω—ã–π/FMC).<br>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ê–û–ù–∞–º–∏.<br>–û—Ü–µ–Ω–∫–∞ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞.</div>
    <div id="tooltip-vatspro">–í–°–ï —Ñ—É–Ω–∫—Ü–∏–∏ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∑–≤–æ–Ω–∫–æ–≤:<br>- –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞<br>- –ø–æ —Å–ø–∏—Å–∫–∞–º –ê–û–ù–æ–≤<br>- –ø–æ –¥–∞–Ω–Ω—ã–º –∏–∑ CRM<br>- –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º/–Ω–æ–º–µ—Ä—É/—Å–µ–≥–º–µ–Ω—Ç–∞–º –∏ –ø—Ä.<br>- –ø–æ –ø—Ä–æ—Ü–µ–Ω—Ç–∞–º<br>- —É—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –ø–æ –∫–æ–ª-–≤—É –∏–ª–∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏<br>- –Ω–µ –∑–≤–æ–Ω–∏—Ç—å —Ä–∞–Ω–µ–µ, —á–µ–º —á–µ—Ä–µ–∑<br>- –∫–æ–ª–ª–∞—É—Ç<br>- –∫–æ–ª–ª–±–µ–∫<br><br>–î–æ–ø. —Ñ—É–Ω–∫—Ü–∏–∏:<br>- —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ê–û–ù–∞–º–∏<br>- –æ–ø—Ü–∏–∏ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞<br>- —Ç—Ä–µ–Ω–µ—Ä<br><br>- –¥–æ 6 –Ω–æ–º–µ—Ä–æ–≤ —É —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞<br>- SIPURI - –∫–∞–Ω–∞–ª—å–Ω–æ—Å—Ç—å 2</div>
    <div id="tooltip-8800">700—Ä. - –º–∏–Ω. —Å—á–µ—Ç, —Ä–∞—Å—Ö–æ–¥—É–µ—Ç—Å—è –Ω–∞ –∑–≤–æ–Ω–∫–∏</div>
    <div id="tooltip-own">–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –Ω–æ–º–µ—Ä–∞ —Å–≤–æ–µ–≥–æ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞, –µ—Å–ª–∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç SIP-–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–ª–æ–≥–∏–Ω, –ø–∞—Ä–æ–ª—å –∏ —Ö–æ—Å—Ç)</div>
    <div id="tooltip-fmc">–ü–æ—Ä—Ç–∞—Ü–∏—è —Å–≤–æ–∏—Ö –Ω–æ–º–µ—Ä–æ–≤ - 0 —Ä—É–±. (—Ç–æ–ª—å–∫–æ —Å–∏–º –ú–°–ö –∏ –æ–±–ª.)</div>
    <div id="tooltip-waba">C—Ç–æ–∏–º–æ—Å—Ç—å –¥–∏–∞–ª–æ–≥–æ–≤:<br>- –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤—ã–µ —à–∞–±–ª–æ–Ω—ã: 9,2—Ä.<br>- –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã: 5,52—Ä.<br>- –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —à–∞–±–ª–æ–Ω—ã: 4,94—Ä.<br>- —Å–µ—Ä–≤–∏—Å–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã: 4,6—Ä.</div>
    <div id="tooltip-omniknopka">–í–∏–¥–∂–µ—Ç, —Ñ–æ—Ä–º–∞, –∫–Ω–æ–ø–∫–∞ —Å –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞–º–∏. –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –≥–∏–±–∫–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è</div>
    <div id="tooltip-ar">- –í–µ–± –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ - —Ñ–∏–∫—Å–∏—Ä—É–µ–º —Ç—Ä–∞—Ñ–∏–∫ –Ω–∞ —Å–∞–π—Ç–µ, —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º<br>- –ó–∞–ø–∏—Å—å –∑–≤–æ–Ω–∫–æ–≤, –ø—Ä–æ—Å–ª—É—à–∫–∞, —Ç–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ<br>- –ó–∞–±–∏—Ä–∞–µ–º –∑–∞—è–≤–∫–∏ —Å —Å–∞–π—Ç–∞ (JS API)<br>- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ú–∞—Ä–∫–≤–∏–∑ –∏ –¢–∏–ª—å–¥–∞<br>- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ä–µ–∫–ª–∞–º–Ω—ã–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏ –∏ —Å –º–µ—Ç—Ä–∏–∫–æ–π<br>- –®–∞–±–ª–æ–Ω–Ω—ã–µ –æ—Ç—á–µ—Ç—ã (—Å–≤–æ–¥–Ω—ã–µ) –±–µ–∑ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è<br>- –°—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ (–æ—Ç—á–µ—Ç—ã)<br>- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ü–µ–ª–µ–π</div>
    <div id="tooltip-traffic">0,2—Ä/–ø–æ—Å–µ—Ç–∏—Ç–µ–ª—å –±–µ–∑ –∏ —Å–≤–µ—Ä—Ö –ø–∞–∫–µ—Ç–∞</div>
    <div id="tooltip-kt">- –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –ö–¢<br>- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –ö–¢ + —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ<br>- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ö–¢ –∏ —Ç.–¥.</div>
    <div id="tooltip-report">- —Å–æ–∑–¥–∞–Ω–∏–µ —Å–≤–æ–∏—Ö –æ—Ç—á–µ—Ç–æ–≤ (—Å–≤–æ–¥–Ω—ã–µ, –¥–∞—à–±–æ—Ä–¥—ã, —Å—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ)<br>- —Å–æ–∑–¥–∞–Ω–∏–µ —Å–≤–æ–∏—Ö —Å—Ç–æ–ª–±—Ü–æ–≤ –∏ –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏<br>- –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∞—Ç—Ä–∏–±—É—Ü–∏–∏ (–≤—Å—è –º—É–ª—å—Ç–∏–∫–∞–Ω–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞)<br><br>–ë–µ–∑ –æ–ø—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã —à–∞–±–ª–æ–Ω–Ω—ã–µ –æ—Ç—á–µ—Ç—ã, –≤ –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ–ª—å–∑—è –Ω–∏—á–µ–≥–æ –º–µ–Ω—è—Ç—å</div>
    <div id="tooltip-crm">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–¥–µ–ª–æ–∫ –∏–∑ CRM –≤ UIS</div>
    <div id="tooltip-otrasl">API, Webhook –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –∑–≤–æ–Ω–∫–æ–≤ –∏–∑ –≤–Ω–µ—à–Ω–µ–π —Å–∏—Å—Ç–µ–º—ã.<br><br>–õ–∏–º–∏—Ç—ã –Ω–∞ –∫–æ–ª-–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤:<br>DataAPI –≤ –º–∏–Ω—É—Ç—É ‚Äî 1‚Äì60 = 0; 61‚Äì900 = 15 —Ä—É–±.<br>DataAPI –≤ –¥–µ–Ω—å ‚Äî 1‚Äì500 = 0; 501‚Äì1200000 = 0.06 —Ä—É–±.<br>HTTP-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ –¥–µ–Ω—å ‚Äî 1‚Äì500 = 0; 501‚Äì1200000 = 0.02 —Ä—É–±.<br>HTTP-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ –º–∏–Ω—É—Ç—É ‚Äî 1‚Äì60 = 0; 61‚Äì900 = 15 —Ä—É–±.<br>Call API –≤ –¥–µ–Ω—å ‚Äî 1‚Äì500 = 0; 501‚Äì40000 = 1 —Ä—É–±.<br>Call API –≤ –º–∏–Ω—É—Ç—É ‚Äî 1‚Äì15 = 0; 16‚Äì300 = 10 —Ä—É–±.</div>
    <div id="tooltip-notify">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ E-mail –∏ SMS (SMS ‚Äî 3.7 —Ä—É–±/—à—Ç)</div>
    <div id="tooltip-ats">–ó–≤–æ–Ω–∫–∏ –º–µ–∂–¥—É UIS –∏ –≤–Ω–µ—à–Ω–µ–π –ê–¢–° –ø–æ –∫–æ—Ä–æ—Ç–∫–∏–º –¥–æ–±–∞–≤–æ—á–Ω—ã–º —á–µ—Ä–µ–∑ SMART-—Ç—Ä–∞–Ω–∫</div>
    <div id="tooltip-save">- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–≤–æ–Ω –ø–æ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–º<br>- –ê–≤—Ç–æ—Ç–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ<br>- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ E-mail –∏ SMS (SMS ‚Äî 3.7 —Ä—É–±/—à—Ç)<br>- –î–∞—à–±–æ—Ä–¥ —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π –ø–æ –∑–≤–æ–Ω–∫–∞–º</div>
    <div id="tooltip-home">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –Ω–æ–º–µ—Ä–∞ –ø—Ä–∏ –∏—Å—Ö–æ–¥—è—â–∏—Ö –∑–≤–æ–Ω–∫–∞—Ö</div>
    <div id="tooltip-min8800">–†–∞—Å—Ö–æ–¥—É–µ—Ç—Å—è –Ω–∞ –∑–≤–æ–Ω–∫–∏ —Å –Ω–æ–º–µ—Ä–∞–º–∏ 8-800</div>
    <div id="tooltip-guarantee">–ë—É–¥–µ—Ç "–∑–∞–º–æ—Ä–æ–∂–µ–Ω" –Ω–∞ —Å—á–µ—Ç–µ –∫–∞–∫ –≥–∞—Ä–∞–Ω—Ç–∏—è –æ–ø–ª–∞—Ç—ã –∏ –≤–æ–∑–≤—Ä–∞—â–µ–Ω –∏–ª–∏ —É—á—Ç–µ–Ω –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –¥–æ–≥–æ–≤–æ—Ä–∞.</div>
    <div id="tooltip-widget">–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ —Ä–µ–∫–ª–∞–º—ã —Å –≤–∏–¥–∂–µ—Ç–∞–º–∏ –∫–ª–∏–µ–Ω—Ç–∞</div>
    <div id="tooltip-connect">–†–∞–∑–æ–≤–æ –∑–∞ –ø–æ–¥–∫–ª—é—á–∞–µ–º—ã–µ –Ω–æ–º–µ—Ä–∞ –∏/–∏–ª–∏ FMC-—Å–∏–º –∫–∞—Ä—Ç—ã</div>
    <div id="tooltip-delivery">–†–∞–∑–æ–≤–æ –∑–∞ –æ–¥–∏–Ω –∞–¥—Ä–µ—Å</div>
    <div id="tooltip-delivery-main">–£–∫–∞–∑–∞–Ω–∞ —Ä–∞–∑–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏ –Ω–∞ –æ–¥–∏–Ω –∞–¥—Ä–µ—Å</div>
</div>

<script>
    /* --- UI LOGIC --- */
    
    // Toggle Visibility
    function toggleExpert() {
        const block = document.getElementById('block-expert');
        const trigger = document.querySelector('.expert-toggle-btn');
        const isHidden = block.style.display === "none";
        block.style.display = isHidden ? "block" : "none";
        trigger.classList.toggle('active', isHidden);
    }

    function toggleAnalytics() {
        const block = document.getElementById('block-ar');
        const header = document.querySelector('.card-header.collapsed, .card-header:not(.static)');
        const isHidden = block.style.display === "none";
        block.style.display = isHidden ? "block" : "none";
        if(header) header.classList.toggle('collapsed', !isHidden);
    }

    // Custom Stepper Logic
    function stepInput(id, delta) {
        const input = document.getElementById(id);
        if(input.disabled) return;
        let val = parseInt(input.value) || 0;
        val += delta;
        if (val < 0) val = 0;
        input.value = val;
        runCascade(id);
    }

    // --- MODAL LOGIC (Info) ---
    function openTooltip(contentId) {
        const text = document.getElementById(contentId).innerHTML;
        document.getElementById('modalText').innerHTML = text;
        document.getElementById('modalOverlay').classList.add('open');
    }

    function closeModal(e, force) {
        if (force || e.target.id === 'modalOverlay') {
            document.getElementById('modalOverlay').classList.remove('open');
        }
    }

    // --- SELECT MODAL LOGIC ---
    let currentSelectId = null;

    function openSelectModal(selectId, title) {
        currentSelectId = selectId;
        const nativeSelect = document.getElementById(selectId);
        const options = Array.from(nativeSelect.options);
        const container = document.getElementById('selectModalOptions');
        const modalTitle = document.getElementById('selectModalTitle');
        
        container.innerHTML = '';
        modalTitle.textContent = title || "–í—ã–±–µ—Ä–∏—Ç–µ –æ–ø—Ü–∏—é";
        
        options.forEach(opt => {
            const item = document.createElement('div');
            item.className = 'modal-option-item';
            if (opt.selected) item.classList.add('selected');
            item.textContent = opt.text;
            item.onclick = () => selectOptionInModal(opt.value);
            container.appendChild(item);
        });

        document.getElementById('selectModalOverlay').classList.add('open');
    }

    function selectOptionInModal(value) {
        const nativeSelect = document.getElementById(currentSelectId);
        nativeSelect.value = value;
        document.getElementById('selectModalOverlay').classList.remove('open');
        updateSelectTrigger(currentSelectId);
        runCascade(currentSelectId);
    }

    function closeSelectModal(e, force) {
        if (force || e.target.id === 'selectModalOverlay') {
            document.getElementById('selectModalOverlay').classList.remove('open');
        }
    }
    
    // Updates the visual "button" for the select
    function updateSelectTrigger(id) {
        const nativeSelect = document.getElementById(id);
        const trigger = nativeSelect.parentElement.querySelector('.custom-select-trigger');
        if (trigger) {
            trigger.textContent = nativeSelect.options[nativeSelect.selectedIndex].text;
        }
    }
    
    // --- MOBILE SHEET LOGIC ---
    let isSheetOpen = false;
    function toggleSheet() {
        const content = document.querySelector('.sheet-content');
        const icon = document.querySelector('.sheet-icon');
        isSheetOpen = !isSheetOpen;
        
        if (isSheetOpen) {
            content.classList.add('open');
            icon.style.transform = "rotate(180deg)";
        } else {
            content.classList.remove('open');
            icon.style.transform = "rotate(0deg)";
        }
    }

    function updateMobileSheet(total, minimal, connect, delivery, guarantee) {
        document.getElementById('mobile-total').textContent = total;
        document.getElementById('mobile-minimal').textContent = minimal;
        document.getElementById('mobile-connection').textContent = connect;
        document.getElementById('mobile-delivery').textContent = delivery;
        document.getElementById('mobile-guarantee').textContent = guarantee;
    }

    document.querySelectorAll('input[type="text"], input[type="number"]').forEach(input => {
      input.addEventListener("focus", function() { this.select(); });
      if (!input.id.startsWith("mgr")) {
        input.addEventListener("blur", () => { if (input.value === "") input.value = "0"; });
      }
    });

    /* --- MANAGER MODAL & PRINT LOGIC --- */
    function openManagerModal() {
        document.getElementById('managerModal').classList.add('open');
    }
    
    function closeManagerModal(e, force) {
        if (force || e.target.id === 'managerModal') {
            document.getElementById('managerModal').classList.remove('open');
        }
    }

    function formatName(input) {
        let val = input.value;
        val = val.replace(/(?:^|\s)\S/g, l => l.toUpperCase());
        input.value = val;
    }

    function formatPhone(input) {
        let val = input.value.replace(/\D/g, '');
        if (val.length > 0) {
            if (val[0] === '8' || val[0] === '7') val = val.substring(1);
            let formatted = '+7 ';
            if (val.length > 0) formatted += '(' + val.substring(0, 3);
            if (val.length >= 4) formatted += ') ' + val.substring(3, 6);
            if (val.length >= 7) formatted += '-' + val.substring(6, 8);
            if (val.length >= 9) formatted += '-' + val.substring(8, 10);
            input.value = formatted;
        } else {
            input.value = '';
        }
    }

    function validateEmail(input) {
        const regex = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,10}$/;
        if (!regex.test(input.value) && input.value !== "") {
            input.classList.add('invalid');
            return false;
        } else {
            input.classList.remove('invalid');
            return true;
        }
    }

    // --- –ù–û–í–û–ï –£–í–ï–î–û–ú–õ–ï–ù–ò–ï (–ö–†–ê–°–ò–í–û–ï) ---
    function showToast(type, title, message, duration = 0) {
        const toast = document.getElementById('mobile-toast');
        const iconEl = document.getElementById('toast-icon');
        const titleEl = document.getElementById('toast-title');
        const msgEl = document.getElementById('toast-message');
        
        // –°–±—Ä–æ—Å –∫–ª–∞—Å—Å–æ–≤
        toast.className = ''; 
        if (type === 'success') {
            toast.classList.add('toast-type-success');
            iconEl.textContent = '‚úÖ';
        } else if (type === 'error') {
            toast.classList.add('toast-type-error');
            iconEl.textContent = '‚ùå';
        } else {
            toast.classList.add('toast-type-loading');
            iconEl.textContent = '‚è≥';
        }
        
        titleEl.innerHTML = title;
        msgEl.innerHTML = message;
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º
        toast.classList.add('visible');
        
        // –ê–≤—Ç–æ-—Å–∫—Ä—ã—Ç–∏–µ (–µ—Å–ª–∏ duration > 0)
        if (duration > 0) {
            setTimeout(() => {
                closeToast();
            }, duration);
        }
    }
    
    function closeToast() {
        document.getElementById('mobile-toast').classList.remove('visible');
    }
    
    function closeToastBackdrop(e) {
        if (e.target.id === 'mobile-toast') {
            closeToast();
        }
    }

    async function printKP() {
        // --- –û–¢–ü–†–ê–í–ö–ê –¶–ï–õ–ò –í –ú–ï–¢–†–ò–ö–£ ---
        // –ó–∞–º–µ–Ω–∏—Ç–µ XXXXXXXX –Ω–∞ –≤–∞—à –Ω–æ–º–µ—Ä —Å—á–µ—Ç—á–∏–∫–∞
        if (typeof ym === 'function') {
            ym(105781169,'reachGoal','print_kp');
        }
        // ------------------------------

        // --- –í–ê–®–ò –ù–ê–°–¢–†–û–ô–ö–ò ---
        const SERVER_URL = "https://gunevgeniy-uis-pdf-server-eeac.twc1.net/generate-pdf";
        // -----------------------

        saveStateToURL();

        const nameInput = document.getElementById('mgrName');
        const phoneInput = document.getElementById('mgrPhone');
        const emailInput = document.getElementById('mgrEmail');
        
        if (emailInput.value !== "" && !validateEmail(emailInput)) {
            alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π Email");
            return;
        }

        const name = nameInput.value.trim();
        const phone = phoneInput.value.trim();
        const email = emailInput.value.trim();
        
        const mgrBlock = document.getElementById('print-manager-block');
        if (name || phone || email) {
            mgrBlock.style.display = 'block';
            document.getElementById('print-mgr-name').textContent = name || '';
            document.getElementById('print-mgr-phone').textContent = phone || '';
            document.getElementById('print-mgr-email').textContent = email || '';
        } else {
            mgrBlock.style.display = 'none';
        }

        // --- –ì–ï–ù–ï–†–ê–¶–ò–Ø –¢–ê–ë–õ–ò–¶–´ ---
        const container = document.getElementById('print-sections-container');
        container.innerHTML = ''; 
        const sections = document.querySelectorAll('.card');
        
        sections.forEach(card => {
            const titleEl = card.querySelector('.card-title');
            if (!titleEl) return;
            const titleText = titleEl.textContent.trim();
            const optionRows = card.querySelectorAll('.option-row');
            const tableRows = [];
            let pendingFMC = null;

            optionRows.forEach(row => {
                const checkbox = row.querySelector('input[type="checkbox"]');
                const number = row.querySelector('input[type="number"], input.stepper-input');
                const select = row.querySelector('select');
                const readonly = row.querySelector('#NomeraVATSVsego');
                let isActive = false;
                let valueText = "";
                
                if (checkbox && checkbox.checked) { isActive = true; valueText = "–í–∫–ª—é—á–µ–Ω–æ"; } 
                else if (number) {
                    const numVal = parseInt(number.value) || 0;
                    if (number.id === 'LiniyGrupovogoVizova') { if (numVal > 3) isActive = true; } 
                    else if (number.id === 'LiniyIshodyashihZvonkov') { if (numVal > 30) isActive = true; } 
                    else if (numVal > 0) { isActive = true; }
                    if (isActive) valueText = number.value + " —à—Ç.";
                } else if (select && select.value !== "0" && select.value !== "–Ω–µ—Ç") {
                    isActive = true;
                    valueText = select.options[select.selectedIndex].text;
                } else if (readonly && parseInt(readonly.value) > 0) {
                    isActive = true;
                    valueText = readonly.value + " —à—Ç.";
                }

                if (isActive) {
                    const nameEl = row.querySelector('.option-name');
                    let nameText = nameEl.innerText.replace('i', '').trim();
                    const infoIcon = row.querySelector('.info-icon');
                    let descText = "";
                    if (infoIcon) {
                        const onClickAttr = infoIcon.getAttribute('onclick');
                        if (onClickAttr) {
                            const match = onClickAttr.match(/'([^']+)'/);
                            if (match && match[1]) {
                                const tooltipContent = document.getElementById(match[1]);
                                if (tooltipContent) descText = tooltipContent.innerHTML;
                            }
                        }
                    }
                    const metaBadges = row.querySelectorAll('.price-badge');
                    let costHtml = "";
                    metaBadges.forEach(badge => { costHtml += `<div>${badge.textContent}</div>`; });

                    if (checkbox && (checkbox.id === 'TgVkAvito' || checkbox.id === 'OMNIKnopka') || (number && number.id === 'KolvoSaitov')) {
                         costHtml = `<div class="price-badge">–±–µ–∑–ª–∏–º–∏—Ç–Ω–æ</div>`;
                    }
                    if (select && select.id === "RegionDostavki") {
                        const regCost = document.getElementById('cost-RegionDostavki-placeholder');
                        let costDisplay = "";
                        if(regCost && regCost.textContent) costDisplay = `<div>${regCost.textContent}</div>`;
                        tableRows.push(`<tr><td style="width:70%"><div class="print-row-name">${nameText}</div><div style="margin-top:4px; font-weight:400; color:#555; font-size:11px;">${valueText}</div>${descText ? `<div class="print-row-desc">${descText}</div>` : ''}</td><td style="width:30%"><div class="print-row-value">${costDisplay}</div></td></tr>`);
                        return;
                    }
                    if (number && number.id === 'KolvoFMC') {
                         const fmcCost = row.closest('.fmc-subgroup')?.querySelector('.fmc-cost-row .price-badge');
                         let finalFmcCost = "";
                         if(fmcCost) finalFmcCost = `<div>${fmcCost.textContent}</div>`;
                         pendingFMC = { name: nameText, val: valueText, cost: finalFmcCost, desc: descText };
                         return;
                    }
                    if (select && select.id === 'TarifFMC') {
                        if (pendingFMC) {
                            tableRows.push(`<tr><td style="width:70%"><div class="print-row-name">${pendingFMC.name} <span style="font-weight:400; color:#555;">(${pendingFMC.val})</span></div><div class="print-row-name" style="margin-top:6px;">${nameText} <span style="font-weight:400; color:#555;">(${valueText})</span></div></td><td style="width:30%; vertical-align:middle;"><div class="print-row-value">${pendingFMC.cost}</div></td></tr>`);
                            pendingFMC = null;
                        } else {
                             tableRows.push(`<tr><td style="width:70%"><div class="print-row-name">${nameText} <span style="font-weight:400; color:#555;">(${valueText})</span></div></td><td style="width:30%"><div class="print-row-value">${costHtml}</div></td></tr>`);
                        }
                        return;
                    }
                    tableRows.push(`<tr><td style="width:70%"><div class="print-row-name">${nameText} <span style="font-weight:400; color:#555;">(${valueText})</span></div>${descText ? `<div class="print-row-desc">${descText}</div>` : ''}</td><td style="width:30%"><div class="print-row-value">${costHtml}</div></td></tr>`);
                }
            });
            if (pendingFMC) {
                 tableRows.push(`<tr><td style="width:70%"><div class="print-row-name">${pendingFMC.name} <span style="font-weight:400; color:#555;">(${pendingFMC.val})</span></div></td><td style="width:30%"><div class="print-row-value">${pendingFMC.cost}</div></td></tr>`);
            }
            if (tableRows.length > 0) {
                const sectionDiv = document.createElement('div');
                sectionDiv.className = 'print-section';
                sectionDiv.innerHTML = `<div class="print-section-title">${titleText}</div><table class="print-table"><tbody>${tableRows.join('')}</tbody></table>`;
                container.appendChild(sectionDiv);
            }
        });

        document.getElementById('print-total-monthly').textContent = document.getElementById('total-monthly').textContent + " ‚ÇΩ / –º–µ—Å";
        document.getElementById('print-total-minimal').textContent = document.getElementById('total-minimal').textContent;
        document.getElementById('print-total-connection').textContent = document.getElementById('total-connection').textContent;
        document.getElementById('print-total-delivery').textContent = document.getElementById('total-delivery').textContent;
        document.getElementById('print-total-guarantee').textContent = document.getElementById('total-guarantee').textContent;
        
        ['print-total-minimal', 'print-total-connection', 'print-total-delivery', 'print-total-guarantee'].forEach(id => {
            const el = document.getElementById(id);
            const row = el.closest('.print-total-row');
            if(el.textContent.trim() === "0 ‚ÇΩ" || el.textContent.trim() === "0 ‚ÇΩ / –º–µ—Å") row.style.display = 'none';
            else row.style.display = 'flex';
        });

        document.getElementById('managerModal').classList.remove('open');

        // ===============================================
        // –õ–û–ì–ò–ö–ê –û–¢–ü–†–ê–í–ö–ò –ò –°–ö–ê–ß–ò–í–ê–ù–ò–Ø
        // ===============================================

        const isWebApp = (window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.initData && window.Telegram.WebApp.initData.length > 0);
        const isMobile = window.matchMedia('(max-width: 900px)').matches;

        if (isWebApp) {
            // WebApp -> –°–µ—Ä–≤–µ—Ä -> –ë–æ—Ç
            const tg = window.Telegram.WebApp;
            tg.ready();
            const userId = tg.initDataUnsafe?.user?.id;

            if (!userId) {
                showToast("error", "–û—à–∏–±–∫–∞", "–ù–µ—Ç ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞.");
                return;
            }

            const btn = document.querySelector('.btn-manager-print');
            const originalText = btn.textContent;
            btn.textContent = "–û—Ç–ø—Ä–∞–≤–∫–∞ –≤ —á–∞—Ç...";
            btn.disabled = true;

            try {
                const printContent = document.getElementById('print-area').innerHTML;
                const styles = document.querySelector('style').innerHTML;

                const response = await fetch(SERVER_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        htmlContent: printContent,
                        cssContent: styles,
                        userId: userId
                    })
                });

                if (response.ok) {
                    showToast("success", "–ì–æ—Ç–æ–≤–æ!", "–ö–ü —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ —á–∞—Ç —Å –±–æ—Ç–æ–º.", 0);
                    // –ù–ï –ó–ê–ö–†–´–í–ê–ï–ú –ü–†–ò–õ–û–ñ–ï–ù–ò–ï (tg.close —É–±—Ä–∞–ª–∏)
                } else {
                    showToast("error", "–û—à–∏–±–∫–∞", "–°–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ. –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–æ–∑–∂–µ.");
                }
            } catch (e) {
                console.error(e);
                showToast("error", "–û—à–∏–±–∫–∞ —Å–µ—Ç–∏", e.message);
            } finally {
                btn.textContent = originalText;
                btn.disabled = false;
            }

        } else if (isMobile) {
            // --- –ú–û–ë–ò–õ–¨–ù–´–ô –ë–†–ê–£–ó–ï–† ---
            
            // 1. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫—Ä–∞—Å–∏–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            showToast(
                "loading",
                "–ö–ü —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ.", 
                "–ï—Å–ª–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ PDF —Ñ–∞–π–ª–∞ –Ω–µ –Ω–∞—á–∞–ª–æ—Å—å ‚Äî –∑–Ω–∞—á–∏—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –µ–≥–æ.<br>–ù–∞–∂–º–∏—Ç–µ <b>‚Ä¢‚Ä¢‚Ä¢</b> —Å–≤–µ—Ä—Ö—É &rarr; <b>–û—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ</b>.", 
                0 // 0 = –ù–ï –°–ö–†–´–í–ê–¢–¨ –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò
            );

            // 2. –°–∫–∞—á–∏–≤–∞–Ω–∏–µ
            const element = document.getElementById('print-area');
            document.body.classList.add('pdf-mode');
            window.scrollTo(0, 0);
            
            const opt = {
              margin:       5,
              filename:     'UIS - –∫–æ–º–º–µ—Ä—á–µ—Å–∫–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ.pdf',
              image:        { type: 'jpeg', quality: 0.98 },
              html2canvas:  { scale: 2, useCORS: true, letterRendering: true, scrollY: 0, scrollX: 0, windowWidth: 800 },
              jsPDF:        { unit: 'mm', format: 'a4', orientation: 'portrait' },
              pagebreak:    { mode: ['css', 'legacy'] } 
            };

            html2pdf().set(opt).from(element).save().then(function(){
                document.body.classList.remove('pdf-mode');
                // –ù–ï –°–ö–†–´–í–ê–ï–ú –£–í–ï–î–û–ú–õ–ï–ù–ò–ï –î–ê–ñ–ï –ü–†–ò –£–°–ü–ï–•–ï
                // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–∫—Ä–æ–µ—Ç —Å–∞–º
            }).catch(err => {
                document.body.classList.remove('pdf-mode');
            });

        } else {
            // --- –î–ï–°–ö–¢–û–ü ---
            setTimeout(() => {
                window.print();
            }, 300);
        }
    }

    /* --- BUSINESS LOGIC --- */

    function resetForm() {
        document.querySelectorAll('input[type="text"], input[type="number"]').forEach(input => {
            if(!input.disabled && !input.id.startsWith("mgr")) input.value = 0;
        });
        document.querySelectorAll('input[type="checkbox"]').forEach(box => {
            box.checked = false;
        });
        document.querySelectorAll('select').forEach(select => {
            select.selectedIndex = 0;
            updateSelectTrigger(select.id);
        });
        const vsego = document.getElementById("NomeraVATSVsego");
        if (vsego) vsego.value = 0;

        if (typeof manualChanges !== 'undefined') manualChanges.clear();
        updateTotals();
    }

    function parseVal(id) {
        const el = document.getElementById(id);
        if (!el) return 0;
        const val = el.value || el.textContent;
        const num = parseFloat(val.toString().replace(/[^\d.]/g, ''));
        return isNaN(num) ? 0 : num;
    }

    function getCheckbox(id) { return document.getElementById(id)?.checked ?? false; }
    function getNumber(id) {
        const val = parseFloat(document.getElementById(id)?.value ?? 0);
        return isNaN(val) ? 0 : val;
    }
    function getSelect(id) { return document.getElementById(id)?.value ?? ""; }

    const formulaMap = {
        VATS: { cost: () => getCheckbox("VATS") ? 1200 : 0 },
        VATSPRO: { cost: () => getCheckbox("VATSPRO") ? 2200 : 0 },
        KolvoSotrudnikovVATS: {
            limit: () => {
                const val = getNumber("KolvoSotrudnikovVATS");
                const vatspro = getCheckbox("VATSPRO");
                return val < 4 ? 0 : (val - 3) * (vatspro ? 200 : 120);
            }
        },
        DlitelnostHraneniyaVATS: {
            limit: () => {
                const ar = getSelect("DlitelnostHraneniyaAR");
                const vats = getSelect("DlitelnostHraneniyaVATS");
                const price = { "1 –º–µ—Å—è—Ü": 500, "3 –º–µ—Å—è—Ü–∞": 1000, "6 –º–µ—Å—è—Ü–µ–≤": 1500, "1 –≥–æ–¥": 3000, "2 –≥–æ–¥–∞": 5000, "4 –≥–æ–¥–∞": 7000 };
                if (!vats || vats === "0") return 0;
                if (!ar || ar === "0") return price[vats] || 0;
                if ((price[ar] || 0) > (price[vats] || 0)) return "—É—á—Ç–µ–Ω–æ –≤ KT";
                return price[vats] || 0;
            }
        },
        LiniyGrupovogoVizova: {
            limit: () => {
                const val = getNumber("LiniyGrupovogoVizova");
                if (val < 4) return 0;
                if (val < 51) return (val - 3) * 190;
                return "—É–º–µ–Ω—å—à–∏—Ç–µ –¥–æ 50";
            }
        },
        LiniyIshodyashihZvonkov: {
            limit: () => {
                const val = getNumber("LiniyIshodyashihZvonkov");
                if (val < 31) return 0;
                if (val < 101) return (val - 30) * 190;
                return "—É–º–µ–Ω—å—à–∏—Ç–µ –¥–æ 100";
            }
        },
        KolvoSIPTrankov: { cost: () => { const val = getNumber("KolvoSIPTrankov"); return val < 1501 ? val * 400 : "—É–º–µ–Ω—å—à–∏—Ç–µ –¥–æ 1500"; } },
        KanalnostSIPTrankov: { limit: () => { const val = getNumber("KanalnostSIPTrankov"); if (val < 31) return 0; if (val < 61) return 1000; if (val < 91) return 1500; if (val < 181) return 3000; return 0; } },
        KolvoSIPURI: { cost: () => { const val = getNumber("KolvoSIPURI"); return val < 1501 ? val * 100 : "—É–º–µ–Ω—å—à–∏—Ç–µ –¥–æ 1500"; } },
        KolvoSIPAkkauntov: { cost: () => { const val = getNumber("KolvoSIPAkkauntov"); return val < 1501 ? val * 300 : "—É–º–µ–Ω—å—à–∏—Ç–µ –¥–æ 1500"; } },
        KanalnostSIPAkkauntov: { limit: () => { const val = getNumber("KanalnostSIPAkkauntov"); if (val < 31) return 0; if (val < 61) return 1000; if (val < 91) return 1500; if (val < 181) return 3000; return 0; } },
        NomeraVATS: { cost: () => getNumber("NomeraVATS") * 300 },
        NomeraVATS8800: { cost: () => getNumber("NomeraVATS8800") * 590 },
        KolvoSvoihNomerov: { cost: () => { const val = getNumber("KolvoSvoihNomerov"); if (val < 1) return 0; if (val < 11) return val * 200; return 2000 + ((val - 10) * 100); } },
        KolvoFMC: {
            cost: () => {
                const tarif = document.getElementById("TarifFMC")?.value || "";
                const count = getNumber("KolvoFMC");
                let price = 0;
                switch (tarif) {
                    case "200 –º–∏–Ω—É—Ç, 1–ì–± –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞": price = 790; break;
                    case "600 –º–∏–Ω—É—Ç, 5–ì–± –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞": price = 1290; break;
                    case "800 –º–∏–Ω—É—Ç, 10–ì–± –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞": price = 1990; break;
                    case "2000 –º–∏–Ω—É—Ç, 20–ì–± –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞": price = 4490; break;
                    case "15 –º–∏–Ω—É—Ç, 0,2–ì–± –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞": price = 390; break;
                }
                return price * count;
            }
        },
        NomeraVATSVsego: { limit: () => { const val = getNumber("NomeraVATSVsego"); return val < 4 ? 0 : (val - 3) * 100; } },
        OMNI: { cost: () => getCheckbox("OMNI") ? 2600 : 0 },
        KolvoSotrudnikovOMNI: {
            limit: () => {
                const val = getNumber("KolvoSotrudnikovOMNI");
                if (val < 4) return 0;
                if (val < 21) return (val - 3) * 590;
                if (val < 31) return (val - 3) * 540;
                if (val < 41) return (val - 3) * 490;
                if (val < 101) return (val - 3) * 440;
                if (val < 201) return (val - 3) * 390;
                if (val < 1001) return (val - 3) * 340;
                if (val < 10001) return (val - 3) * 290;
                return "—É–º–µ–Ω—å—à–∏—Ç–µ –¥–æ 10000";
            }
        },
        KolvoWA: { limit: () => getNumber("KolvoWA") * 990 },
        KolvoWABA: { cost: () => getNumber("KolvoWABA") > 0 ? 4000 : 0, limit: () => getNumber("KolvoWABA") * 5000 },
        TgVkAvito: { cost: () => getCheckbox("TgVkAvito") ? "–≤–∫–ª" : 0 },
        OMNIKnopka: { cost: () => getCheckbox("OMNIKnopka") ? "–≤–∫–ª" : 0 },
        AR: { cost: () => getCheckbox("AR") ? 2000 : 0 },
        KolvoSaitov: { limit: () => getNumber("KolvoSaitov") ? "–≤–∫–ª" : 0 },
        KolvoPolzovatelskihIstochnikov: { limit: () => { const val = getNumber("KolvoPolzovatelskihIstochnikov"); if (val === 250) return 1000; if (val === 500) return 2000; if (val === 5000) return 3000; return 0; } },
        PaketTrafika: {
            limit: () => {
                const val = document.getElementById("PaketTrafika")?.value || "";
                const num = parseInt(val);
                if (val === "–±–µ–∑–ª–∏–º–∏—Ç") return 50000;
                if (num === 0 || num === 10000) return 0;
                if (num === 20000) return 1000;
                if (num === 50000) return 3500;
                if (num === 100000) return 7500;
                if (num === 200000) return 15000;
                if (num === 500000) return 30000;
                return 50000;
            }
        },
        KT: { cost: () => getCheckbox("KT") ? 1500 : 0 },
        NomeraKT: { cost: () => getNumber("NomeraKT") * 300 },
        NomeraKT8800: { cost: () => getNumber("NomeraKT8800") * 590 },
        DlitelnostHraneniyaAR: {
            limit: () => {
                const values = { "0": 0, "1 –º–µ—Å—è—Ü": 500, "3 –º–µ—Å—è—Ü–∞": 1000, "6 –º–µ—Å—è—Ü–µ–≤": 1500, "1 –≥–æ–¥": 3000, "2 –≥–æ–¥–∞": 5000, "4 –≥–æ–¥–∞": 7000 };
                const vats = document.getElementById("DlitelnostHraneniyaVATS")?.value || "";
                const ar = document.getElementById("DlitelnostHraneniyaAR")?.value || "";
                if (ar === "0") return 0;
                const vatsVal = values[vats] ?? 0;
                const arVal = values[ar] ?? 0;
                return vatsVal >= arVal ? "—É—á—Ç–µ–Ω–æ –≤ –í–ê–¢–°" : arVal;
            }
        },
        EmailTreking: { cost: () => document.getElementById("EmailTreking")?.value !== "–Ω–µ—Ç" ? 2000 : 0, limit: () => document.getElementById("EmailTreking")?.value === "–±–æ–ª—å—à–µ 100 —à—Ç." ? 1000 : 0 },
        KonstruktorOtchetov: { cost: () => getCheckbox("KonstruktorOtchetov") ? 4000 : 0 },
        AnalitikaProdaj: { cost: () => getCheckbox("AnalitikaProdaj") ? 3000 : 0 },
        IntegraciyaSVidjetami: { cost: () => getCheckbox("IntegraciyaSVidjetami") ? 2000 : 0 },
        AmoBitrix: { cost: () => getCheckbox("AmoBitrix") ? 1500 : 0 },
        IntegraciyaOtraslevie: { cost: () => getCheckbox("IntegraciyaOtraslevie") ? 2000 : 0 },
        UvedomlenieOSobitiyah: { cost: () => getCheckbox("UvedomlenieOSobitiyah") ? 800 : 0 },
        VneshnieATS: { cost: () => getCheckbox("VneshnieATS") ? 3000 : 0 },
        SpasenieKommunikatsiy: { cost: () => getCheckbox("SpasenieKommunikatsiy") ? 1600 : 0 },
        AvtoperezvonPoZayavkam: { cost: () => getCheckbox("AvtoperezvonPoZayavkam") ? 1600 : 0 },
        VezdeKakDoma: { cost: () => getCheckbox("VezdeKakDoma") ? 2000 : 0 }
    };

    const rules = {
      VATS: (context) => {
        const val = getCheckbox("VATS");
        if (val === true) {
          context.select("DlitelnostHraneniyaVATS", "1 –Ω–µ–¥–µ–ª—è");
          if (getNumber("KolvoSotrudnikovVATS") < 3) context.set("KolvoSotrudnikovVATS", 3);
          if (getNumber("LiniyGrupovogoVizova") < 3) context.set("LiniyGrupovogoVizova", 3);
          if (getNumber("LiniyIshodyashihZvonkov") < 30) context.set("LiniyIshodyashihZvonkov", 30);
        } else {
          context.set("KolvoSotrudnikovVATS", 0);
          context.set("LiniyGrupovogoVizova", 0);
          context.set("LiniyIshodyashihZvonkov", 0);
          context.set("KolvoSIPTrankov", 0);
          context.set("KolvoSIPURI", 0);
          context.set("KolvoSIPAkkauntov", 0);
          context.set("NomeraVATS", 0);
          context.set("NomeraVATS8800", 0);
          context.set("KolvoSvoihNomerov", 0);
          context.set("KolvoFMC", 0);

          context.set("VATSPRO", false);
          context.select("DlitelnostHraneniyaVATS", 0);
          context.select("KanalnostSIPTrankov", 0);
          context.select("KanalnostSIPAkkauntov", 0);
          context.select("TarifFMC", "–Ω–µ—Ç");
          context.select("RegionDostavki", "–Ω–µ—Ç");

          context.set("VneshnieATS", false);
          context.set("SpasenieKommunikatsiy", false);
          context.set("AvtoperezvonPoZayavkam", false);
          context.set("VezdeKakDoma", false);

          if (!getCheckbox("OMNI") && !getCheckbox("AnalitikaProdaj")) {
            context.set("AmoBitrix", false);
          }

          context.set("IntegraciyaOtraslevie", false);

          if (
            getCheckbox("UvedomlenieOSobitiyah") === true &&
            !getCheckbox("OMNI") &&
            !getCheckbox("AR")
          ) {
            context.set("UvedomlenieOSobitiyah", false);
          }
        }
      },
      VATSPRO: (context) => {
        if (getCheckbox("VATSPRO") && !getCheckbox("VATS")) {
          context.set("VATS", true);
        }
      },
      KolvoSotrudnikovVATS: (context) => {
        const val = getNumber("KolvoSotrudnikovVATS");
        if (val > 0 && !getCheckbox("VATS")) {
          context.set("VATS", true);
        }

        if (val > 0 && val < 3) {
          context.set("KolvoSotrudnikovVATS", 3);
        }

        if (
          val === 0 &&
          getNumber("KolvoSIPTrankov") === 0 &&
          getNumber("KolvoSIPURI") === 0 &&
          getNumber("KolvoSIPAkkauntov") === 0 &&
          getCheckbox("VATS") === true
        ) {
          context.set("VATS", false);
        }
      },
      DlitelnostHraneniyaVATS: (context) => {
        const val = document.getElementById("DlitelnostHraneniyaVATS")?.value;
        if (val !== "0" && !getCheckbox("VATS")) {
          context.set("VATS", true);
        }
        if (val === "0" && getCheckbox("VATS")) {
          context.select("DlitelnostHraneniyaVATS", "1 –Ω–µ–¥–µ–ª—è");
        }
      },
      LiniyGrupovogoVizova: (context) => {
        const val = getNumber("LiniyGrupovogoVizova");
        if (val > 0 && !getCheckbox("VATS")) {
          context.set("VATS", true);
        }
        if (val >= 0 && val < 3 && getCheckbox("VATS")) {
          context.set("LiniyGrupovogoVizova", 3);
        }
      },
      LiniyIshodyashihZvonkov: (context) => {
        const val = getNumber("LiniyIshodyashihZvonkov");
        if (val > 0 && !getCheckbox("VATS")) {
          context.set("VATS", true);
        }
        if (val >= 0 && val < 30 && getCheckbox("VATS")) {
          context.set("LiniyIshodyashihZvonkov", 30);
        }
      },
      KolvoSIPTrankov: (context) => {
        const val = getNumber("KolvoSIPTrankov");
        const kanalnost = document.getElementById("KanalnostSIPTrankov")?.value;
        if (val > 0) {
          if (!getCheckbox("VATS")) {
            context.set("VATS", true);
          }
          if (parseInt(kanalnost, 10) < 30) {
            context.select("KanalnostSIPTrankov", "30");
          }
        }
        if (
          val === 0 &&
          getNumber("KolvoSotrudnikovVATS") === 0 &&
          getNumber("KolvoSIPURI") === 0 &&
          getNumber("KolvoSIPAkkauntov") === 0 &&
          getCheckbox("VATS") === true
        ) {
          context.set("VATS", false);
        }
        if (val === 0 && kanalnost !== "0") {
          context.select("KanalnostSIPTrankov", "0");
        }
      },
      KanalnostSIPTrankov: (context) => {
        const val = document.getElementById("KanalnostSIPTrankov")?.value;
        if (val !== "0") {
          if (!getCheckbox("VATS")) {
            context.set("VATS", true);
          }
          if (getNumber("KolvoSIPTrankov") === 0) {
            context.set("KolvoSIPTrankov", 1);
          }
        } else {
          if (getNumber("KolvoSIPTrankov") !== 0) {
            context.set("KolvoSIPTrankov", 0);
          }
        }
      },
      KolvoSIPURI: (context) => {
        const val = getNumber("KolvoSIPURI");
        if (val > 0 && !getCheckbox("VATS")) {
          context.set("VATS", true);
        }
        if (
          val === 0 &&
          getNumber("KolvoSotrudnikovVATS") === 0 &&
          getNumber("KolvoSIPTrankov") === 0 &&
          getNumber("KolvoSIPAkkauntov") === 0 &&
          getCheckbox("VATS") === true
        ) {
          context.set("VATS", false);
        }
      },
      KolvoSIPAkkauntov: (context) => {
        const val = getNumber("KolvoSIPAkkauntov");
        const kanalnost = document.getElementById("KanalnostSIPAkkauntov")?.value;
        if (val > 0) {
          if (!getCheckbox("VATS")) {
            context.set("VATS", true);
          }
          if (parseInt(kanalnost, 10) < 30) {
            context.select("KanalnostSIPAkkauntov", "30");
          }
        }
        if (
          val === 0 &&
          getNumber("KolvoSotrudnikovVATS") === 0 &&
          getNumber("KolvoSIPURI") === 0 &&
          getNumber("KolvoSIPTrankov") === 0 &&
          getCheckbox("VATS") === true
        ) {
          context.set("VATS", false);
        }
        if (val === 0 && kanalnost !== "0") {
          context.select("KanalnostSIPAkkauntov", "0");
        }
      },
      KanalnostSIPAkkauntov: (context) => {
        const val = document.getElementById("KanalnostSIPAkkauntov")?.value;
        if (val !== "0") {
          if (!getCheckbox("VATS")) {
            context.set("VATS", true);
          }
          if (getNumber("KolvoSIPAkkauntov") === 0) {
            context.set("KolvoSIPAkkauntov", 1);
          }
        } else {
          if (getNumber("KolvoSIPAkkauntov") !== 0) {
            context.set("KolvoSIPAkkauntov", 0);
          }
        }
      },
      NomeraVATS: (context) => {
        const val = getNumber("NomeraVATS");
        if (val > 0 && !getCheckbox("VATS")) {
          context.set("VATS", true);
        }
      },
      NomeraVATS8800: (context) => {
        const val = getNumber("NomeraVATS8800");
        if (val > 0 && !getCheckbox("VATS")) {
          context.set("VATS", true);
        }
      },
      KolvoSvoihNomerov: (context) => {
        const val = getNumber("KolvoSvoihNomerov");
        if (val > 0 && !getCheckbox("VATS")) {
          context.set("VATS", true);
        }
      },
      KolvoFMC: (context) => {
        const val = getNumber("KolvoFMC");
        if (val > 0) {
          if (!getCheckbox("VATS")) {
            context.set("VATS", true);
          }
          const tarif = document.getElementById("TarifFMC")?.value;
          if (tarif === "–Ω–µ—Ç") {
            const options = document.getElementById("TarifFMC")?.options;
            if (options?.length > 1) {
              context.select("TarifFMC", options[1].value);
            }
          }
        } else {
          if (document.getElementById("TarifFMC")?.value !== "–Ω–µ—Ç") {
            context.select("TarifFMC", "–Ω–µ—Ç");
          }
          if (document.getElementById("RegionDostavki")?.value !== "–Ω–µ—Ç") {
            context.select("RegionDostavki", "–Ω–µ—Ç");
          }
        }
      },
      TarifFMC: (context) => {
        const val = document.getElementById("TarifFMC")?.value;
        if (val && val !== "–Ω–µ—Ç") {
          if (!getCheckbox("VATS")) {
            context.set("VATS", true);
          }
          if (getNumber("KolvoFMC") === 0) {
            context.set("KolvoFMC", 1);
          }
        } else {
          if (getNumber("KolvoFMC") !== 0) {
            context.set("KolvoFMC", 0);
          }
          if (document.getElementById("RegionDostavki")?.value !== "–Ω–µ—Ç") {
            context.select("RegionDostavki", "–Ω–µ—Ç");
          }
        }
      },
      RegionDostavki: (context) => {
        const val = document.getElementById("RegionDostavki")?.value;
        if (val && val !== "–Ω–µ—Ç") {
          if (!getCheckbox("VATS")) {
            context.set("VATS", true);
          }
          if (getNumber("KolvoFMC") === 0) {
            context.set("KolvoFMC", 1);
          }
          const tarif = document.getElementById("TarifFMC")?.value;
          if (tarif === "–Ω–µ—Ç") {
            const options = document.getElementById("TarifFMC")?.options;
            if (options?.length > 1) {
              context.select("TarifFMC", options[1].value);
            }
          }
        }
      },
      OMNI: (context) => {
        const val = getCheckbox("OMNI");
        if (val === true) {
          if (getNumber("KolvoSotrudnikovOMNI") < 3) {
            context.set("KolvoSotrudnikovOMNI", 3);
          }
          if (!getCheckbox("TgVkAvito")) {
            context.set("TgVkAvito", true);
          }
          if (!getCheckbox("OMNIKnopka")) {
            context.set("OMNIKnopka", true);
          }
        } else {
          context.set("KolvoSotrudnikovOMNI", 0);
          context.set("KolvoWA", 0);
          context.set("KolvoWABA", 0);
          context.set("TgVkAvito", false);
          context.set("OMNIKnopka", false);

          if (!getCheckbox("VATS") && !getCheckbox("AnalitikaProdaj")) {
            context.set("AmoBitrix", false);
          }
          if (!getCheckbox("VATS") && !getCheckbox("AR")) {
            context.set("UvedomlenieOSobitiyah", false);
          }
        }
      },
      KolvoSotrudnikovOMNI: (context) => {
        const val = getNumber("KolvoSotrudnikovOMNI");
        if (val > 0) {
          if (!getCheckbox("OMNI")) {
            context.set("OMNI", true);
          }
          if (val < 3) {
            context.set("KolvoSotrudnikovOMNI", 3);
          }
        }
        if (val === 0 && getCheckbox("OMNI")) {
          context.set("OMNI", false);
        }
      },
      KolvoWA: (context) => {
        if (getNumber("KolvoWA") > 0 && !getCheckbox("OMNI")) {
          context.set("OMNI", true);
        }
      },
      KolvoWABA: (context) => {
        if (getNumber("KolvoWABA") > 0 && !getCheckbox("OMNI")) {
          context.set("OMNI", true);
        }
      },
      TgVkAvito: (context) => {
        if (getCheckbox("TgVkAvito") && !getCheckbox("OMNI")) {
          context.set("OMNI", true);
        }
      },
      OMNIKnopka: (context) => {
        if (getCheckbox("OMNIKnopka") && !getCheckbox("OMNI")) {
          context.set("OMNI", true);
        }
      },
      AR: (context) => {
        if (getCheckbox("AR")) {
          if (getNumber("KolvoSaitov") === 0) {
            context.set("KolvoSaitov", 1);
          }
          context.select("KolvoPolzovatelskihIstochnikov", "50");
          context.select("PaketTrafika", "10000");
        } else {
          context.set("KolvoSaitov", 0);
          context.select("KolvoPolzovatelskihIstochnikov", "0");
          context.select("PaketTrafika", "0");
          context.select("EmailTreking", "–Ω–µ—Ç");

          context.set("KT", false);
          context.set("NomeraKT", 0);
          context.set("NomeraKT8800", 0);
          context.select("DlitelnostHraneniyaAR", "0");
          context.set("KonstruktorOtchetov", false);
          context.set("AnalitikaProdaj", false);
          context.set("IntegraciyaSVidjetami", false);
          context.set("AvtoperezvonPoZayavkam", false);
          if (!getCheckbox("VATS") && !getCheckbox("OMNI")) {
            context.set("UvedomlenieOSobitiyah", false);
          }
        }
      },
      KolvoSaitov: (context) => {
        if (getNumber("KolvoSaitov") > 0 && !getCheckbox("AR")) {
          context.set("AR", true);
        }
      },
      KolvoPolzovatelskihIstochnikov: (context) => {
        const val = document.getElementById("KolvoPolzovatelskihIstochnikov")?.value;
        if (val && val !== "0" && !getCheckbox("AR")) {
          context.set("AR", true);
        }
      },
      PaketTrafika: (context) => {
        const val = document.getElementById("PaketTrafika")?.value;
        if (val && val !== "0" && !getCheckbox("AR")) {
          context.set("AR", true);
        }
      },
      KT: (context) => {
        const val = getCheckbox("KT");
        if (val === true && !getCheckbox("AR")) {
          context.set("AR", true);
        }
        if (val === false) {
          context.set("NomeraKT", 0);
          context.set("NomeraKT8800", 0);
          context.select("DlitelnostHraneniyaAR", "0");
        }
      },
      NomeraKT: (context) => {
        if (getNumber("NomeraKT") > 0 && !getCheckbox("KT")) {
          context.set("KT", true);
        }
      },
      NomeraKT8800: (context) => {
        if (getNumber("NomeraKT8800") > 0 && !getCheckbox("KT")) {
          context.set("KT", true);
        }
      },
      DlitelnostHraneniyaAR: (context) => {
        const val = document.getElementById("DlitelnostHraneniyaAR")?.value;
        if (val !== "0" && !getCheckbox("KT")) {
          context.set("KT", true);
        }
        if (val === "0" && getCheckbox("KT")) {
          context.select("DlitelnostHraneniyaAR", "1 –Ω–µ–¥–µ–ª—è");
        }
      },
      EmailTreking: (context) => {
        const val = document.getElementById("EmailTreking")?.value;
        if (val && val !== "–Ω–µ—Ç" && !getCheckbox("AR")) {
          context.set("AR", true);
        }
      },
      KonstruktorOtchetov: (context) => {
        if (getCheckbox("KonstruktorOtchetov") && !getCheckbox("AR")) {
          context.set("AR", true);
        }
      },
      AnalitikaProdaj: (context) => {
        if (getCheckbox("AnalitikaProdaj")) {
          if (!getCheckbox("AR")) {
            context.set("AR", true);
          }
          if (!getCheckbox("AmoBitrix")) {
            context.set("AmoBitrix", true);
          }
        } else {
          if (!getCheckbox("OMNI") && !getCheckbox("VATS")) {
            context.set("AmoBitrix", false);
          }
        }
      },
      IntegraciyaSVidjetami: (context) => {
        if (getCheckbox("IntegraciyaSVidjetami") && !getCheckbox("AR")) {
          context.set("AR", true);
        }
      },
      IntegraciyaOtraslevie: (context) => {
        if (getCheckbox("IntegraciyaOtraslevie") && !getCheckbox("VATS")) {
          context.set("VATS", true);
        }
      },
      VneshnieATS: (context) => {
        if (getCheckbox("VneshnieATS") && !getCheckbox("VATS")) {
          context.set("VATS", true);
        }
      },
      AmoBitrix: (context) => {
        if (getCheckbox("AmoBitrix")) {
          if (!getCheckbox("VATS") && !getCheckbox("OMNI") && !getCheckbox("AnalitikaProdaj")) {
            context.set("VATS", true);
          }
        } else {
          if (getCheckbox("AnalitikaProdaj")) {
            context.set("AnalitikaProdaj", false);
          }
        }
      },
      VezdeKakDoma: (context) => {
        if (getCheckbox("VezdeKakDoma") && !getCheckbox("VATS")) {
          context.set("VATS", true);
        }
      },
      UvedomlenieOSobitiyah: (context) => {
        if (getCheckbox("UvedomlenieOSobitiyah")) {
          if (getCheckbox("SpasenieKommunikatsiy")) {
            context.set("UvedomlenieOSobitiyah", false);
          } else if (!getCheckbox("VATS") && !getCheckbox("OMNI") && !getCheckbox("AR")) {
            context.set("VATS", true);
          }
        }
      },
      SpasenieKommunikatsiy: (context) => {
        if (getCheckbox("SpasenieKommunikatsiy")) {
          document.getElementById('UvedomlenieOSobitiyah').disabled = true;
          if (!getCheckbox("VATS")) {
            context.set("VATS", true);
          }
          if (getCheckbox("UvedomlenieOSobitiyah")) {
            context.set("UvedomlenieOSobitiyah", false);
          }
        } else {
          document.getElementById('UvedomlenieOSobitiyah').disabled = false;
        }
      },
      AvtoperezvonPoZayavkam: (context) => {
        if (getCheckbox("AvtoperezvonPoZayavkam")) {
          if (!getCheckbox("VATS")) {
            context.set("VATS", true);
          }
          if (!getCheckbox("AR")) {
            context.set("AR", true);
          }
        }
      },
    };

    const manualChanges = new Set();
    let cascadeQueue = [];
    let isProcessing = false;

    function runCascade(startField) {
        if (isProcessing) { manualChanges.add(startField); return; }
        cascadeQueue = [startField];
        isProcessing = true;
        let depth = 0; const maxDepth = 3;
        const context = {
            set: (id, value) => {
                const el = document.getElementById(id); if (!el) return;
                const current = el.type === "checkbox" ? el.checked : el.value;
                const changedByUser = manualChanges.has(id);
                const isSame = current == value; 
                if (isSame || changedByUser) return;
                
                if (el.type === "checkbox") el.checked = value; else el.value = value;
                cascadeQueue.push(id);
            },
            select: (id, value) => {
                const el = document.getElementById(id); if (!el) return;
                const changedByUser = manualChanges.has(id);
                const isSame = el.value === value;
                if (isSame || changedByUser) return;
                
                el.value = value;
                updateSelectTrigger(id);
                cascadeQueue.push(id);
            }
        };
        while (cascadeQueue.length && depth < maxDepth) {
            const current = cascadeQueue.shift();
            const rule = rules[current];
            if (rule) rule(context);
            depth++;
        }
        isProcessing = false;
        manualChanges.clear();
        updateTotals();
    }

    function updateTotals() {
        const sumAll = parseVal("NomeraVATS") + parseVal("NomeraVATS8800") + parseVal("KolvoFMC");
        const vsego = document.getElementById("NomeraVATSVsego");
        if(vsego) vsego.value = sumAll;

        Object.entries(formulaMap).forEach(([id, formula]) => {
            const costEl = document.getElementById(`cost-${id}`);
            const limitEl = document.getElementById(`limit-${id}`);
            
            if(costEl) costEl.innerHTML = '';
            if(limitEl && limitEl !== costEl) limitEl.innerHTML = '';

            let costVal = null;
            let limitVal = null;

            if (formula.cost) {
                const val = formula.cost();
                if (typeof val === "number" && val > 0) costVal = val;
                else if (val && val !== 0 && typeof val === "string") costVal = val;
            }

            if (formula.limit) {
                const val = formula.limit();
                if (typeof val === "number" && val > 0) limitVal = val;
                else if (val && val !== 0 && typeof val === "string") limitVal = val;
            }

            const createBadge = (val, type) => {
                const badge = document.createElement('div');
                badge.className = `price-badge ${type}`;
                const isNum = typeof val === 'number';
                badge.textContent = isNum ? `${val.toLocaleString('ru-RU')} ‚ÇΩ${type === 'cost' ? ' / –º–µ—Å' : ''}` : val;
                
                if(type === 'limit' && isNum) badge.textContent = `+${val.toLocaleString('ru-RU')} ‚ÇΩ / –º–µ—Å - —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ`;
                
                if(String(val).includes("–≤–∫–ª")) badge.textContent = "–í–∫–ª—é—á–µ–Ω–æ";
                if(String(val).includes("—É–º–µ–Ω—å—à–∏—Ç–µ")) { badge.textContent = val; badge.style.color = "red"; }
                return badge;
            };

            if(costEl && costVal !== null) {
                costEl.appendChild(createBadge(costVal, 'cost'));
            }

            if(limitVal !== null) {
                if(limitEl && limitEl !== costEl) {
                    limitEl.appendChild(createBadge(limitVal, 'limit'));
                } else if(costEl) {
                     costEl.appendChild(createBadge(limitVal, 'limit'));
                }
            }
        });

        let total = 0;
        Object.entries(formulaMap).forEach(([id, formula]) => {
            if(formula.cost) {
                const v = formula.cost();
                if(typeof v === 'number') total += v;
            }
            if(formula.limit) {
                const v = formula.limit();
                if(typeof v === 'number') total += v;
            }
        });

        const totalFormatted = total.toLocaleString('ru-RU');
        document.getElementById('total-monthly').textContent = totalFormatted;

        const nom8800 = parseVal("NomeraVATS8800") + parseVal("NomeraKT8800");
        const minimal = (nom8800 * 700).toLocaleString('ru-RU');
        document.getElementById('total-minimal').textContent = minimal + " ‚ÇΩ / –º–µ—Å";

        const connect = (parseVal("NomeraVATS") * 300 + parseVal("KolvoFMC") * 250).toLocaleString('ru-RU');
        document.getElementById('total-connection').textContent = connect + " ‚ÇΩ";

        const region = (document.getElementById("RegionDostavki")?.value || "").trim();
        let delPrice = 0;
        if (region.includes("–ú–æ—Å–∫–≤–∞") || region.includes("–ü–µ—Ç–µ—Ä–±—É—Ä–≥")) delPrice = 500;
        else if (region.includes("–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è")) delPrice = 750;
        else if (region.includes("–Æ–≥")) delPrice = 1000;
        else if (region.includes("–î–∞–ª—å–Ω–∏–π")) delPrice = 1300;
        document.getElementById('total-delivery').textContent = delPrice + " ‚ÇΩ";

        const regionPlaceholder = document.getElementById('cost-RegionDostavki-placeholder');
        if (regionPlaceholder) {
            if (delPrice > 0) {
                regionPlaceholder.className = 'price-badge cost';
                regionPlaceholder.textContent = `+${delPrice.toLocaleString('ru-RU')} ‚ÇΩ - –¥–æ—Å—Ç–∞–≤–∫–∞`;
            } else {
                regionPlaceholder.textContent = '';
                regionPlaceholder.className = '';
            }
        }

        const monthly = total;
        const minimalNum = nom8800 * 700;
        const connectionNum = parseVal("NomeraVATS") * 300 + parseVal("KolvoFMC") * 250;
        const baseSum = monthly + minimalNum + connectionNum;
        const guarantee = baseSum > 0 ? (baseSum < 4000 ? 4000 : baseSum) : 0;
        document.getElementById('total-guarantee').textContent = guarantee.toLocaleString('ru-RU') + " ‚ÇΩ";

        const maxLimit = baseSum <= 10000 ? guarantee * 2 : guarantee * 1.7;
        const guaranteeTooltipText = `–ë—É–¥–µ—Ç "–∑–∞–º–æ—Ä–æ–∂–µ–Ω" –Ω–∞ —Å—á–µ—Ç–µ –∫–∞–∫ –≥–∞—Ä–∞–Ω—Ç–∏—è –æ–ø–ª–∞—Ç—ã –∏ –≤–æ–∑–≤—Ä–∞—â–µ–Ω –∏–ª–∏ —É—á—Ç–µ–Ω –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –¥–æ–≥–æ–≤–æ—Ä–∞. <br>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –ø–æ—Ä–æ–≥ –∫—Ä–µ–¥–∏—Ç–Ω–æ–≥–æ –ª–∏–º–∏—Ç–∞: <b>${maxLimit.toLocaleString('ru-RU')} —Ä—É–±.</b>`;
        document.getElementById('tooltip-guarantee').innerHTML = guaranteeTooltipText;
        
        const printGuaranteeDesc = document.getElementById('print-total-guarantee-desc');
        if(printGuaranteeDesc) printGuaranteeDesc.innerHTML = guaranteeTooltipText;
        
        updateMobileSheet(totalFormatted + " ‚ÇΩ / –º–µ—Å", minimal + " ‚ÇΩ / –º–µ—Å", connect + " ‚ÇΩ", delPrice + " ‚ÇΩ", guarantee.toLocaleString('ru-RU') + " ‚ÇΩ");
    }
    
    document.querySelectorAll('select').forEach(s => updateSelectTrigger(s.id));
    
    function saveStateToURL() {
        const params = new URLSearchParams();

        document.querySelectorAll('input, select').forEach(el => {
            if (!el.id || el.id.startsWith('mobile-') || el.id.startsWith('total-') || el.id.startsWith('cost-') || el.id.startsWith('limit-')) return;
            
            let val = null;
            
            if (el.type === 'checkbox') {
                if (el.checked) val = '1';
            } else {
                if (el.value && el.value !== '0' && el.value !== '–Ω–µ—Ç') {
                    val = el.value;
                }
            }

            if (val !== null) {
                params.set(el.id, encodeURIComponent(val));
            }
        });

        const newUrl = window.location.pathname + '?' + params.toString();
        window.history.replaceState(null, '', newUrl);
    }

    function restoreStateFromURL() {
        const params = new URLSearchParams(window.location.search);
        if ([...params].length === 0) return;

        params.forEach((encodedVal, key) => {
            const el = document.getElementById(key);
            if (el) {
                const val = decodeURIComponent(encodedVal);
                if (el.type === 'checkbox') {
                    el.checked = (val === '1');
                } else {
                    el.value = val;
                }
                if (el.tagName === 'SELECT') {
                    updateSelectTrigger(el.id);
                }
            }
        });

        const cascadeOrder = [
            'VATS', 'VATSPRO', 'OMNI', 'AR', 'KT', 
            'KolvoSotrudnikovVATS', 'KolvoFMC', 'TarifFMC', 'RegionDostavki'
        ];
        
        cascadeOrder.forEach(id => {
            if (params.has(id)) {
                runCascade(id);
            }
        });

        params.forEach((_, key) => {
            if (!cascadeOrder.includes(key)) {
                runCascade(key);
            }
        });

        updateTotals();
    }

    document.querySelectorAll('input, select').forEach(el => {
        el.addEventListener('change', saveStateToURL);
        el.addEventListener('input', saveStateToURL);
    });

    restoreStateFromURL();
    updateTotals();
</script>

</body>
</html>